function isEmpty(e){return e&&0!==e.length?!1:!0}function has_images(e){return isEmpty(e)===!1}function make_image_tag(e){return"<img class='' src='"+e+"'>"}function get_thumbnail_url(e){return has_images(e)?e[0].image_thumb:""}function get_medium_url(e){return has_images(e)?e[0].image_medium:""}function get_full_url(e){return has_images(e)?e[0].image_full:""}function truncate(e,t){return null===e?"":e.length>t&&t>=3?e.substr(0,t-3)+"...":e}function tags_display(e){if(null===e)return"";var t=e.split("|");return 1===t.length?e:_.map(t,function(e){return"'"+e+"'"}).join(",")}function humanize(e){return null===e||0===e.length?e:(e=e.replace(/_/g," "),e=e.charAt(0).toUpperCase()+e.slice(1))}"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,o,r,s,a=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(r=l.length,i=0;r>i;i+=1)s[i]=str(i,l)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(r=rep.length,i=0;r>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],o=str(n,l),o&&s.push(quote(n)+(gap?": ":":")+o));else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(o=str(n,l),o&&s.push(quote(n)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var i,n,o=e[t];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n=walk(o,i),void 0!==n?o[i]=n:delete o[i]);return reviver.call(e,t,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),$(function(){PSToolkit.AjaxModalForm=Backbone.View.extend({template:JST["ps_toolkit/templates/ajax_modal_form"],successHandler:null,errorHandler:this.onError,initialize:function(){_.bindAll(this,"onSuccess","onError","onSubmit","onCancel")},setSuccessHandler:function(e){this.successHandler=e},setErrorHandler:function(e){this.errorHandler=e},render:function(){var e=this.template({title:this.options.title,form:this.$el.html(),submitLabel:this.options.submitLabel,cancelLabel:this.options.cancelLabel});this.$el.addClass("modal fade"),this.$el.attr("tabindex","-1"),this.$el.attr("role","dialog"),this.$el.attr("aria-labelledby",this.options.title),this.$el.attr("aria-hidden","true"),this.$el.html(e);var t=this.$("form");t.submit(this.onSubmit),this.formOriginal=t.clone(),this.submitButton=this.$(".submit-button"),this.submitButton.click(this.onSubmit),this.$(".cancel-button").click(this.onCancel)},onSubmit:function(){var e=this.$("form");return e.closest(".modal-content").find(".submit-button").addClass("disabled"),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),dataType:"JSON"}).success(_.bind(function(e){this.submitButton.removeClass("disabled"),this.onSuccess(e)},this)).error(_.bind(function(e,t,i){this.submitButton.removeClass("disabled"),this.errorHandler(e,t,i)},this)),!1},onCancel:function(){var e=this.formOriginal.clone();this.$("form").replaceWith(e)},onSuccess:function(e){null===this.successHandler?window.location.href=e.url:(this.$("form").closest(".modal-content").find(".submit-button").removeClass("disabled"),this.successHandler(e))},onError:function(e){this.$("form .btn-primary").removeClass("disabled");var t=e.responseJSON,i=this.$("form");i.find(".error-explanation").detach();var n=$("<div>",{"class":"error-explanation"});i.prepend(n);var o=_.size(t)>1?"Errors":"Error";n.append("<h2>"+o+" prohibited this edition from being saved:</h2>");var r=$("<ul>");_.each(t,function(e,t){r.append("<li>"+e+": "+t+"</li>")}),n.append(r)}})}),$(function(){PSToolkit.DraggableDialog=Backbone.View.extend({dialogTemplate:JST["ps_toolkit/templates/draggable-dialog"],className:"draggable-dialog",events:{"mousedown .title-bar":"onStartDrag"},initialize:function(){this.title=this.options.title,this.closeIcon=this.options.closeIcon,this.offset=this.options.offset,this._render=this.options.renderCallback,_.bindAll(this,"onDrag","onStopDrag")},render:function(){this.$el.html(this.dialogTemplate({title:this.title,panelBody:this._render,closeIcon:this.closeIcon})),$("body").append(this.el),this.$el.offset(this.offset)},onStartDrag:function(e){this.dragOffset={left:e.offsetX,top:e.offsetY};var t=$("body");t.on("mousemove.humEdit",this.onDrag),t.on("mouseup.humEdit",this.onStopDrag)},onDrag:function(e){this.$el.offset({left:e.pageX-this.dragOffset.left,top:e.pageY-this.dragOffset.top})},onStopDrag:function(){var e=$("body");e.off("mousemove.humEdit"),e.off("mouseup.humEdit")}})}),$(function(){PSToolkit.GithubSyncWizard=Backbone.View.extend({successHandler:null,stepNumber:1,gitAccount:null,gitRepo:null,customToken:null,events:{"click .add-git-account-button":"onAddGitAccount","click .git-account-entry":"onSelectAccount","click .next-button":"onNextStep","click .prev-button":"onPrevStep","keyup input":"onTextChanged","click .update-git-account-button":"onSubmitCredentials","click .cancel-git-account-button":"onCancelPass"},begin:function(){this.stepNumber=1,this.gitAccount=null,this.gitRepo=null,this.customToken=null,this.getWizardForm()},getWizardForm:function(){this.$(".next-button").text("Next"),this.$(".next-button").removeAttr("disabled"),this.$(".prev-button").removeAttr("disabled");var e="";1===this.stepNumber?this.$(".prev-button").attr("disabled","disabled"):2===this.stepNumber&&(e="?u="+this.gitAccount,this.$(".next-button").text("Done")),$.getJSON("/github_sync_wizard/"+this.stepNumber+e,_.bind(function(e){var t=$("#github-sync-wizard-modal .modal-body");if(t.empty(),t.append(e.form),$("#github-sync-wizard-modal").modal({backdrop:"static"}),2===this.stepNumber){if(this.gitRepo){var i=this.$('#github-repos .hidden-repo:contains("'+this.gitRepo+'")'),n=i.closest("p");n.addClass("selected");var o=this.$("#github-repos");o.scrollTop(o.scrollTop()+n.position().top)}e.error&&($("div.git-password-prompt").show(),$("#update-git-pass").val(""),$(".next-button").attr("disabled","disable"),$("#git-message").text("Unable to access GitHub repositories for this account!\n\nAccess has either expired, changed or been revoked. Update your credentials now."),$("#update-git-pass").focus())}else if(1===this.stepNumber)if(this.gitAccount){var n=this.$("#git-"+this.gitAccount);n.addClass("selected");var o=this.$("#existing-accounts");o.scrollTop(o.scrollTop()+n.position().top)}else this.$("#list-panel").hasClass("hidden")&&(this.$(".next-button").attr("disabled","disable"),this.$("#step-desc").text("Step 1: Add GitHub Account"))},this)).error(function(){alert("Error running website wizard")})},onCancelPass:function(){$(".modal-footer").show(),$("div.git-password-prompt").hide(),$(".next-button").removeAttr("disabled")},onSubmitCredentials:function(){var e=this.$("#update-git-pass").val();return 0===e.length?void alert("Please enter a password"):void $.ajax({url:"/github/"+this.gitAccount,type:"PUT",data:{password:e},success:function(e){var t=$("#github-sync-wizard-modal .modal-body");t.empty(),t.append(e.form),$(".next-button").removeAttr("disabled")},error:function(e){alert("Unable to add GitHub account:\n\n "+e.responseText)}})},validateGitAccountStep:function(){if(this.$("#add-panel").hasClass("hidden")){var e=$(".git-account-entry.selected");if(0===e.length)return void alert("Please select an account!");this.gitAccount=e.attr("id").substring("git-".length),this.stepNumber+=1,this.getWizardForm()}else this.addGitAccount()},completed:function(){var e={edition_id:this.options.editionId,account:this.gitAccount,repo:this.gitRepo};this.$(".next-button").attr("disabled","disabled"),this.$(".prev-button").attr("disabled","disabled"),$(".disable-sync-button").removeClass("hidden"),$.ajax({url:"/github_sync_wizard/done",type:"POST",data:e,success:_.bind(function(){$("#github-sync-wizard-modal").modal("hide")},this),error:function(e){alert("Error configuring: "+e.responseText)}})},onNextStep:function(){if(1===this.stepNumber)this.validateGitAccountStep();else if(2===this.stepNumber){var e=$(".git-account-entry.selected");if(0!==e.length)return this.gitRepo=e.find(".hidden-repo").text(),void this.completed();alert("Please select a repository!")}},onPrevStep:function(){this.stepNumber-=1,this.getWizardForm()},onSelectAccount:function(e){$(".git-account-entry").removeClass("selected"),$(e.target).addClass("selected")},onAddGitAccount:function(){this.$("#list-panel").addClass("hidden"),this.$("#step-desc").text("Step 1: Add GitHub Account"),this.$("#add-panel").removeClass("hidden"),this.$(".next-button").attr("disabled","disabled"),this.$("#new-git").focus()},onTextChanged:function(){1==this.stepNumber&&(this.$("#new-git").val().length>0&&this.$("#new-git-pass").val().length>0?this.$(".next-button").removeAttr("disabled"):this.$(".next-button").attr("disabled","disabled"))},addGitAccount:function(){var e=this.$("#new-git").val();if(0===e.length)return void alert("A GitHub user name is required");var t=this.$("#new-git-pass").val();if(0===t.length)return void alert("A password is required");var i=this.$("#new-git-org").val();$.ajax({url:"/github",type:"POST",data:{user:e,password:t,org:i},success:_.bind(function(e){this.gitAccount=e.id,this.stepNumber+=1,this.getWizardForm()},this),error:function(e){alert("Unable to add GitHub account:\n\n "+e.responseText)}})},initialize:function(){_.bindAll(this,"onSuccess","onError","onSubmit","onCancel")},setSuccessHandler:function(e){this.successHandler=e},render:function(){this.$el.addClass("modal fade"),this.$el.attr("tabindex","-1"),this.$el.attr("role","dialog"),this.$el.attr("aria-labelledby","Create Website Wizard"),this.$el.attr("aria-hidden","true")},onSubmit:function(){var e=this.$("form");return $.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),dataType:"JSON"}).success(this.onSuccess).error(this.onError),!1},onCancel:function(){var e=this.formOriginal.clone();this.$("form").replaceWith(e)},onSuccess:function(e){null===this.successHandler?window.location.href=e.url:this.successHandler(e)},onError:function(e){var t=e.responseJSON,i=this.$("form");i.find(".error-explanation").detach();var n=$("<div>",{"class":"error-explanation"});i.prepend(n);var o=_.size(t)>1?"Errors":"Error";n.append("<h2>"+o+" prohibited this edition from being saved:</h2>");var r=$("<ul>");_.each(t,function(e,t){r.append("<li>"+e+": "+t+"</li>")}),n.append(r)}})}),$(function(){PSToolkit.ManageCollaborators=Backbone.View.extend({events:{"click #invite-collaborator":"onInviteCollaborator","click .close":"onClose","click .close-button":"onClose","click .delete-icon":"onDeleteCollaborator"},initialize:function(){_.bindAll(this,"open")},open:function(){$("table.collaborators tr.collaborator").remove(),$.getJSON("/editions/"+this.options.editionId+"/collaborators",function(e){$("table.collaborators > tbody:last").append(e.html)}),this.$("#flash-messages").hide(),$("#collaborators-modal").modal("show")},onClose:function(){this.$("#flash-alert").text(""),this.$("#collaborator-name").val(""),$("#collaborators-modal").modal("hide")},onDeleteCollaborator:function(e){if(resp=window.confirm("Remove this collaborator?")){var t=$(e.target).data("collaborator"),i=$(e.target).closest("tr");$.ajax({url:"/editions/"+this.options.editionId+"/collaborators?id="+t,type:"DELETE",success:_.bind(function(){i.remove(),$("#collaborators-modal").data("refresh-edition",!0)},this),error:_.bind(function(e){this.$("#flash-alert").text(e.responseText),this.$("#flash-messages").show()},this)})}},onInviteCollaborator:function(){var e=this.$("#collaborator-name").val();return 0===e.length?(this.$("#flash-messages").show(),void this.$("#flash-alert").text("Please enter a username")):void $.ajax({url:"/editions/"+this.options.editionId+"/collaborators",type:"POST",data:{username:e},success:_.bind(function(e){this.$("#collaborator-name").val(""),this.$("#flash-messages").hide(),this.$("table.collaborators > tbody:first").after(e.html),$("#collaborators-modal").data("refresh-edition",!0)},this),error:_.bind(function(e){this.$("#flash-alert").text(e.responseText),this.$("#flash-messages").show()},this)})},render:function(){this.$el.addClass("modal fade"),this.$el.attr("tabindex","-1"),this.$el.attr("role","dialog"),this.$el.attr("aria-labelledby","Manage Collaborators"),this.$el.attr("aria-hidden","true")}})});var PSToolkit={};$(function(){PSToolkit.ShuffleTable=Backbone.View.extend({shuffleControlTemplate:"<td class='shuffle-control'><a href='#' class='up glyphicon glyphicon-arrow-up'></a><a href='#' class='down glyphicon glyphicon-arrow-down'></a></td>",initialize:function(){this.dataField=this.options.dataField,_.bindAll(this,"shuffleDown","shuffleUp")},render:function(){this.$(".shuffle-row").append(this.shuffleControlTemplate),$(".shuffle-control .up").click(this.shuffleUp),$(".shuffle-control .down").click(this.shuffleDown),this.updateArrows()},updateDataField:function(){var e=_.map(this.$(".shuffle-id"),function(e){return $(e).html()});this.dataField.val(JSON.stringify(e))},updateArrows:function(){var e=this.$(".shuffle-row");_.each(e,function(t,i){var n=$(t).find(".up"),o=$(t).find(".down");0==i&&1==e.length?(n.addClass("hidden"),o.addClass("hidden")):0==i?(n.addClass("hidden"),o.removeClass("hidden")):i==e.length-1?(n.removeClass("hidden"),o.addClass("hidden")):(n.removeClass("hidden"),o.removeClass("hidden"))})},shuffleUp:function(e){var t=$(e.currentTarget.parentElement.parentElement),i=t.prev();return t.detach(),i.before(t),this.updateArrows(),this.updateDataField(),!1},shuffleDown:function(e){var t=$(e.currentTarget.parentElement.parentElement),i=t.next();return t.detach(),i.after(t),this.updateArrows(),this.updateDataField(),!1}})}),function(){this.JST||(this.JST={}),this.JST["ps_toolkit/templates/ajax_modal_form"]=function(obj){var __p=[];with(obj||{})__p.push(' <div class="modal-dialog">\n   <div class="modal-content">\n     <div class="modal-header">\n       <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n       <h4 class="modal-title">',title,'</h4>\n     </div>\n     <div class="modal-body">\n	',form,'\n     </div>\n     <div class="modal-footer">\n	<a class="btn btn-default cancel-button" data-dismiss="modal" href="#">',cancelLabel,'</a>\n       <a class="btn btn-primary submit-button" href="#">',submitLabel,"</a>\n     </div>\n   </div>\n </div>\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["ps_toolkit/templates/draggable-dialog"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="panel">\n  <div class="panel-heading title-bar">',title,'<span class="glyphicon ',closeIcon,' close-x"/></div>\n  <div class="panel-body">\n	',panelBody(),"\n  </div>\n</div>\n");return __p.join("")}}.call(this),$(function(){PSToolkit.WebsiteWizard=Backbone.View.extend({successHandler:null,stepNumber:1,customSite:!1,typeId:-1,gitAccount:null,gitRepo:null,siteHome:null,customDomain:!0,customToken:null,events:{"click .add-git-button":"onAddGitAccount","click .git-account-entry":"onSelectAccount","click .next-button":"onNextStep","click .prev-button":"onPrevStep","click .update-git-button":"onSubmitCredentials","change #domain-type":"onTextChanged","keyup input":"onTextChanged","click .cancel-git-button":"onCancelPass"},begin:function(){this.stepNumber=1,this.typeId=-1,this.customSite=!1,this.gitAccount=null,this.gitRepo=null,this.siteHome=null,this.customDomain=!1,this.customToken=null,this.getWizardForm()},pollStatus:function(){var e=$("#publication-id").text(),t=setInterval(_.bind(function(){$.getJSON("/tasks/"+e+"?type=publish",_.bind(function(e){if("READY"===e.status){clearInterval(t);var i=$("#site-table .status-col span");i.removeClass("collating").addClass("ok"),i.attr("title","Ready");var n=$("#site-table .url-col");n.empty(),n.append(e.form),n.css("font-style","normal");var o=$("#site-table .time-col");o.text("less than a minute ago");var r=$("p.pub-error");r.hasClass("hidden")===!1&&r.addClass("hidden")}else if("ERROR"===e.status){clearInterval(t);var i=$("#site-table .status-col span");i.removeClass("collating").addClass("error"),i.attr("title","Error");var o=$("#site-table .time-col");o.text("less than a minute ago");var r=$("p.pub-error");r.text(e.message),r.removeClass("hidden"),r.show()}},this)).error(_.bind(function(e){clearInterval(t);var i=$("#site-table .status-col span");i.removeClass("collating").addClass("error"),i.attr("title","Publication failed");var n=$("p.pub-error");n.text(e.responseText),n.removeClass("hidden"),n.show()},this))},this),2e3)},onDomainTypeChanged:function(){this.siteHome=null,$("#ws-home").val(""),"juxta"===this.$("#domain-type").val()?($("#domain-help").addClass("hidden"),$("#home-label").text("Site home:")):($("#domain-help").removeClass("hidden"),$("#home-label").text("Domain:"))},getWizardForm:function(){this.$(".next-button").text("Next"),this.$(".next-button").removeAttr("disabled"),this.$(".prev-button").removeAttr("disabled");var e="?type="+this.typeId;this.customSite===!0&&this.customToken&&(e+="&token="+this.customToken);var t="&domain=juxta";this.customDomain===!0&&(t="&domain=custom&token="+this.customToken);var i=e;1===this.stepNumber?this.$(".prev-button").attr("disabled","disabled"):4===this.stepNumber?i+="&u="+this.gitAccount:6==this.stepNumber?i+=t:7==this.stepNumber&&(i+=t+"&repo="+encodeURIComponent(this.gitRepo)+"&home="+encodeURIComponent(this.siteHome),this.$(".next-button").text("Publish")),$.getJSON("/website_wizard/"+this.stepNumber+i,_.bind(function(e){var t=$("#website-wizard-modal .modal-body");if(t.empty(),t.append(e.form),$("#website-wizard-modal").modal({backdrop:"static"}),6===this.stepNumber)null!=this.siteHome?$("#ws-home").val(this.siteHome):this.$(".next-button").attr("disabled","disabled");else if(5===this.stepNumber)this.customDomain===!1?this.$("input:radio[value=juxta]").prop("checked",!0):this.$("input:radio[value=custom]").prop("checked",!0);else if(4===this.stepNumber){if(this.gitRepo){var i=this.$('#github-repos .hidden-repo:contains("'+this.gitRepo+'")'),n=i.closest("p");n.addClass("selected");var o=this.$("#github-repos");o.scrollTop(o.scrollTop()+n.position().top)}e.error&&($("div.git-password-prompt").show(),$("#update-git-pass").val(""),$(".next-button").attr("disabled","disable"),$("#git-message").text("Unable to access GitHub repositories for this account!\n\nAccess has either expired, changed or been revoked. Update your credentials now."),$("#update-git-pass").focus())}else if(3===this.stepNumber)if(this.gitAccount){var n=this.$("#git-"+this.gitAccount);n.addClass("selected");var o=this.$("#existing-accounts");o.scrollTop(o.scrollTop()+n.position().top)}else this.$("#list-panel").hasClass("hidden")&&(this.$(".next-button").attr("disabled","disable"),this.$("#step-desc").text("Step 3: Add GitHub Account"));else 1===this.stepNumber&&this.typeId>-1&&this.$("input:radio[value="+this.typeId+"]").prop("checked",!0)},this)).error(function(){alert("Error running website wizard")})},onCancelPass:function(){$(".modal-footer").show(),$("div.git-password-prompt").hide(),$(".next-button").removeAttr("disabled")},onSubmitCredentials:function(){var e=this.$("#update-git-pass").val();return 0===e.length?void alert("Please enter a password"):void $.ajax({url:"/github/"+this.gitAccount,type:"PUT",data:{password:e},success:function(e){var t=$("#website-wizard-modal .modal-body");t.empty(),t.append(e.form),$(".next-button").removeAttr("disabled")},error:function(e){alert("Unable to add GitHub account:\n\n "+e.responseText)}})},validateGitAccountStep:function(){if(this.$("#add-panel").hasClass("hidden")){var e=$(".git-account-entry.selected");if(0===e.length)return void alert("Please select an account!");this.gitAccount=e.attr("id").substring("git-".length),this.stepNumber+=1,this.getWizardForm()}else this.addGitAccount()},validateSiteName:function(){if(this.siteHome=$("#ws-home").val(),this.customDomain===!1&&this.siteHome.indexOf(".")>-1){var e=confirm("You have selected Juxta Editions Subdomain, but provided a name that looks like a domain. Are you sure?");if(e!==!0)return}var t="&domain=juxta";this.customDomain===!0&&(t="&domain=custom"),$.getJSON("/website_wizard/validate?home="+encodeURIComponent(this.siteHome)+t,_.bind(function(e){this.customDomain===!0&&(this.customToken=e.s3_folder),this.stepNumber+=1,this.getWizardForm(),$("#error_explanation").addClass("hidden")},this)).error(function(e){$("#error_explanation").removeClass("hidden"),$("#error_explanation h2").text(e.responseText)})},publishSite:function(){var e={edition_id:this.options.editionId,type:this.typeId};this.customSite===!0&&(e.account=this.gitAccount,e.repo=this.gitRepo),this.customDomain===!0?(e.domain="custom",e.s3Root=this.customToken,e.customDomain=this.siteHome):(e.domain="juxta",e.s3Root=this.siteHome),this.$(".next-button").attr("disabled","disabled"),this.$(".prev-button").attr("disabled","disabled"),$.ajax({url:"/website_wizard/publish",type:"POST",data:e,success:_.bind(function(e){var t=$("#publication-controls .panel-body");t.empty(),t.append(e.panel),$("#website-wizard-modal").modal("hide"),this.pollStatus()},this),error:function(e){alert("Error publishing website: "+e.responseText)}})},onNextStep:function(){if(1===this.stepNumber){var e=this.$("input:radio[name=site-type]:checked"),t=e.closest("li"),i=t.find("label");this.customSite=!1,this.typeId=e.val(),i.text().toLowerCase().indexOf("custom")>-1?(this.customSite=!0,this.stepNumber=2):this.stepNumber=5,this.getWizardForm()}else if(2===this.stepNumber)this.stepNumber+=1,this.getWizardForm();else if(3===this.stepNumber)this.validateGitAccountStep();else if(4===this.stepNumber){var n=$(".git-account-entry.selected");if(0===n.length)return void alert("Please select a repository!");this.gitRepo=n.find(".hidden-repo").text(),this.stepNumber+=1,this.getWizardForm()}else if(5===this.stepNumber){var o=this.$("input:radio[name=domain-type]:checked").val();this.customDomain="custom"===o,this.stepNumber+=1,this.getWizardForm()}else 6===this.stepNumber?this.validateSiteName():7===this.stepNumber&&this.publishSite()},onPrevStep:function(){this.customSite===!1&&5===this.stepNumber?this.stepNumber=1:this.stepNumber-=1,this.getWizardForm()},onSelectAccount:function(e){$(".git-account-entry").removeClass("selected"),$(e.target).addClass("selected")},onAddGitAccount:function(){this.$("#list-panel").addClass("hidden"),this.$("#step-desc").text("Step 3: Add GitHub Account"),this.$("#add-panel").removeClass("hidden"),this.$(".next-button").attr("disabled","disabled"),this.$("#new-git").focus()},onTextChanged:function(){6==this.stepNumber?this.$("#ws-home").val().length>0?this.$(".next-button").removeAttr("disabled"):this.$(".next-button").attr("disabled","disabled"):3==this.stepNumber&&(this.$("#new-git").val().length>0&&this.$("#new-git-pass").val().length>0?this.$(".next-button").removeAttr("disabled"):this.$(".next-button").attr("disabled","disabled"))},addGitAccount:function(){var e=this.$("#new-git").val();if(0===e.length)return void alert("A GitHub user name is required");var t=this.$("#new-git-pass").val();if(0===t.length)return void alert("A password is required");var i=this.$("#new-git-org").val();$.ajax({url:"/github",type:"POST",data:{user:e,password:t,org:i},success:_.bind(function(e){this.gitAccount=e.id,this.stepNumber+=1,this.getWizardForm()},this),error:function(e){alert("Unable to add GitHub account:\n\n "+e.responseText)}})},initialize:function(){_.bindAll(this,"onSuccess","onError","onSubmit","onCancel")},setSuccessHandler:function(e){this.successHandler=e},render:function(){this.$el.addClass("modal fade"),this.$el.attr("tabindex","-1"),this.$el.attr("role","dialog"),this.$el.attr("aria-labelledby","Create Website Wizard"),this.$el.attr("aria-hidden","true")},onSubmit:function(){var e=this.$("form");return $.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),dataType:"JSON"}).success(this.onSuccess).error(this.onError),!1},onCancel:function(){var e=this.formOriginal.clone();this.$("form").replaceWith(e)},onSuccess:function(e){null===this.successHandler?window.location.href=e.url:this.successHandler(e)},onError:function(e){var t=e.responseJSON,i=this.$("form");i.find(".error-explanation").detach();var n=$("<div>",{"class":"error-explanation"});i.prepend(n);var o=_.size(t)>1?"Errors":"Error";n.append("<h2>"+o+" prohibited this edition from being saved:</h2>");var r=$("<ul>");_.each(t,function(e,t){r.append("<li>"+e+": "+t+"</li>")}),n.append(r)}})}),window.OpenSeadragon=window.OpenSeadragon||function(e){return new OpenSeadragon.Viewer(e)},function(e){e.version={versionStr:"1.0.0",major:1,minor:0,revision:0};var t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null===e||void 0===e?String(e):t[i.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!n.call(t,"constructor")&&!n.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(i in t);return void 0===i||n.call(t,i)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.supportsCanvas=function(){var t=document.createElement("canvas");return!(!e.isFunction(t.getContext)||!t.getContext("2d"))}()}(OpenSeadragon),function(e){function t(e,t){return t&&e!=document.body?document.body:e.offsetParent}e.extend=function(){var e,t,i,n,o,r,s=arguments[0]||{},a=arguments.length,l=!1,h=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},h=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===h&&(s=this,--h);a>h;h++)if(e=arguments[h],null!==e||void 0!==e)for(t in e)i=s[t],n=e[t],s!==n&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(o=OpenSeadragon.isArray(n)))?(o?(o=!1,r=i&&OpenSeadragon.isArray(i)?i:[]):r=i&&OpenSeadragon.isPlainObject(i)?i:{},s[t]=OpenSeadragon.extend(l,r,n)):void 0!==n&&(s[t]=n));return s},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,springStiffness:7,clickTimeThreshold:300,clickDistThreshold:5,zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,animationTime:1.2,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,pixelsPerWheelLine:40,autoResize:!0,showSequenceControl:!0,preserveViewport:!1,showNavigationControl:!0,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorHeight:null,navigatorWidth:null,navigatorPosition:null,navigatorSizeRatio:.2,degrees:0,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},navPrevNextWrap:!1,debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(i){var n,o,r=new e.Point;for(i=e.getElement(i),n="fixed"==e.getElementStyle(i).position,o=t(i,n);o;)r.x+=i.offsetLeft,r.y+=i.offsetTop,n&&(r=r.plus(e.getPageScroll())),i=o,n="fixed"==e.getElementStyle(i).position,o=t(i,n);return r},getElementOffset:function(t){t=e.getElement(t);var i,n,o=t&&t.ownerDocument,r={top:0,left:0};return o?(i=o.documentElement,"undefined"!=typeof t.getBoundingClientRect&&(r=t.getBoundingClientRect()),n=o==o.window?o:9===o.nodeType?o.defaultView||o.parentWindow:!1,new e.Point(r.left+(n.pageXOffset||i.scrollLeft)-(i.clientLeft||0),r.top+(n.pageYOffset||i.scrollTop)-(i.clientTop||0))):new e.Point},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=e.getElement(t),t.currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},getEvent:function(t){return e.getEvent=t?function(e){return e}:function(){return window.event},e.getEvent(t)},getMousePosition:function(t){if("number"==typeof t.pageX)e.getMousePosition=function(t){var i=new e.Point;return t=e.getEvent(t),i.x=t.pageX,i.y=t.pageY,i};else{if("number"!=typeof t.clientX)throw new Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(t){var i=new e.Point;return t=e.getEvent(t),i.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,i}}return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.pageXOffset)e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(i.scrollLeft||i.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!t.scrollLeft&&!t.scrollTop)return new e.Point(0,0);e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return e.getPageScroll()},setPageScroll:function(t){if("undefined"!=typeof window.scrollTo)e.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var i=e.getPageScroll();if(i.x===t.x&&i.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;
var n=e.getPageScroll();if(n.x!==i.x&&n.y!==i.y)return void(e.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,n=e.getPageScroll(),n.x!==i.x&&n.y!==i.y)return void(e.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});e.setPageScroll=function(){}}return e.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.innerWidth)e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!i.clientWidth&&!i.clientHeight)throw new Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(t){t=e.getElement(t);var i=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(i[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(i[1].style,{display:"table-row"}),e.extend(i[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),i[0].appendChild(i[1]),i[1].appendChild(i[2]),i[2].appendChild(t),i[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return e.now=Date.now?Date.now:function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(t){return e.makeTransparentImage=function(t){var i=e.makeNeutralElement("img");return i.src=t,i},e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<7&&(e.makeTransparentImage=function(t){var i=e.makeNeutralElement("img"),n=null;return n=e.makeNeutralElement("span"),n.style.display="inline-block",i.onload=function(){n.style.width=n.style.width||i.width+"px",n.style.height=n.style.height||i.height+"px",i.onload=null,i=null},i.src=t,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",n}),e.makeTransparentImage(t)},setElementOpacity:function(t,i,n){var o,r;t=e.getElement(t),n&&!e.Browser.alpha&&(i=Math.round(i)),e.Browser.opacity?t.style.opacity=1>i?i:"":1>i?(o=Math.round(100*i),r="alpha(opacity="+o+")",t.style.filter=r):t.style.filter=""},addClass:function(t,i){t=e.getElement(t),t.className?-1===(" "+t.className+" ").indexOf(" "+i+" ")&&(t.className+=" "+i):t.className=i},removeClass:function(t,i){var n,o,r=[];for(t=e.getElement(t),n=t.className.split(/\s+/),o=0;o<n.length;o++)n[o]&&n[o]!==i&&r.push(n[o]);t.className=r.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,i,n,o){t=e.getElement(t),t.addEventListener(i,n,o)};if(window.attachEvent)return function(t,i,n,o){t=e.getElement(t),t.attachEvent("on"+i,n),o&&t.setCapture&&t.setCapture()};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,i,n,o){t=e.getElement(t),t.removeEventListener(i,n,o)};if(window.detachEvent)return function(t,i,n,o){t=e.getElement(t),t.detachEvent("on"+i,n),o&&t.releaseCapture&&t.releaseCapture()};throw new Error("No known event model.")}(),cancelEvent:function(t){t=e.getEvent(t),e.cancelEvent=t.preventDefault?function(e){e.preventDefault()}:function(t){t=e.getEvent(t),t.cancel=!0,t.returnValue=!1},e.cancelEvent(t)},stopEvent:function(t){t=e.getEvent(t),e.stopEvent=t.stopPropagation?function(e){e.stopPropagation()}:function(t){t=e.getEvent(t),t.cancelBubble=!0},e.stopEvent(t)},createCallback:function(e,t){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,o=n.concat([]);for(i=0;i<arguments.length;i++)o.push(arguments[i]);return t.apply(e,o)}},getUrlParameter:function(e){var t=o[e];return t?t:null},createAjaxRequest:function(){var t;if(window.XMLHttpRequest)e.createAjaxRequest=function(){return new XMLHttpRequest},t=new XMLHttpRequest;else if(window.ActiveXObject)for(var n=0;n<i.length;n++)try{t=new ActiveXObject(i[n]),e.createAjaxRequest=function(){return new ActiveXObject(i[n])};break}catch(o){continue}if(!t)throw new Error("Browser doesn't support XMLHttpRequest.");return t},makeAjaxRequest:function(t,i,n){var o=e.createAjaxRequest();if(!e.isFunction(i))throw new Error("makeAjaxRequest requires a success callback");o.onreadystatechange=function(){4==o.readyState&&(o.onreadystatechange=function(){},200==o.status?i(o):(e.console.log("AJAX request returned %s: %s",o.status,t),e.isFunction(n)&&n(o)))};try{o.open("GET",t,!0),o.send(null)}catch(r){var s=r.message,a=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<10;a&&"undefined"!=typeof r.number&&-2147024891==r.number&&(s+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),e.console.log("%s while making AJAX request: %s",r.name,s),o.onreadystatechange=function(){},e.isFunction(n)&&n(o,r)}},jsonp:function(t){var i,n=t.url,o=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=t.callbackName||"openseadragon"+e.now(),s=window[r],a="$1"+r+"$2",l=t.param||"callback",h=t.callback;n=n.replace(/(\=)\?(&|$)|\?\?/i,a),n+=(/\?/.test(n)?"&":"?")+l+"="+r,window[r]=function(t){if(s)window[r]=s;else try{delete window[r]}catch(i){}h&&e.isFunction(h)&&h(t)},i=document.createElement("script"),(void 0!==t.async||!1!==t.async)&&(i.async="async"),t.scriptCharset&&(i.charset=t.scriptCharset),i.src=n,i.onload=i.onreadystatechange=function(e,t){(t||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,o&&i.parentNode&&o.removeChild(i),i=void 0)},o.insertBefore(i,o.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.ActiveXObject)e.parseXml=function(e){var t=null;return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t};else{if(!window.DOMParser)throw new Error("Browser doesn't support XML DOM.");e.parseXml=function(e){var t,i=null;return t=new DOMParser,i=t.parseFromString(e,"text/xml")}}return e.parseXml(t)},imageFormatSupported:function(e){return e=e?e:"",!!n[e.toLowerCase()]}}),e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var i=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"],n={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},o={};!function(){var t=(navigator.appName,navigator.appVersion),i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(i.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):i.indexOf("Safari")>=0&&(e.Browser.vendor=i.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(t)}var n,r,s,a=window.location.search.substring(1),l=a.split("&");for(s=0;s<l.length;s++)n=l[s],r=n.indexOf("="),r>0&&(o[n.substring(0,r)]=decodeURIComponent(n.substring(r+1)));e.Browser.alpha=!(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9||e.Browser.vendor==e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9)}();var r=function(){};e.console=window.console||{log:r,debug:r,info:r,warn:r,error:r},function(t){var i=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,n=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(i&&n)e.requestAnimationFrame=function(){return i.apply(t,arguments)},e.cancelAnimationFrame=function(){return n.apply(t,arguments)};else{var o,r=[],s=[],a=0;e.requestAnimationFrame=function(t){return r.push([++a,t]),o||(o=setInterval(function(){if(r.length){var t=e.now(),i=s;for(s=r,r=i;s.length;)s.shift()[1](t)}else clearInterval(o),o=void 0},20)),a},e.cancelAnimationFrame=function(e){var t,i;for(t=0,i=r.length;i>t;t+=1)if(r[t][0]===e)return void r.splice(t,1);for(t=0,i=s.length;i>t;t+=1)if(s[t][0]===e)return void s.splice(t,1)}}}(window),e._processDZIError=function(e){var t=e.getElementsByTagName("Message")[0],i=t.firstChild.nodeValue;throw new Error(i)}}(OpenSeadragon),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:"",prefix:""},i="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.cancelFullScreen)t.supportsFullScreen=!0;else for(var n=0,o=i.length;o>n;n++)if(t.prefix=i[n],"undefined"!=typeof document[t.prefix+"CancelFullScreen"]){t.supportsFullScreen=!0;break}t.supportsFullScreen?(t.fullScreenEventName=t.prefix+"fullscreenchange",t.fullScreenErrorEventName=t.prefix+"fullscreenerror",t.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},t.requestFullScreen=function(e){return""===this.prefix?e.requestFullScreen():e[this.prefix+"RequestFullScreen"]()},t.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}):"undefined"!=typeof window.ActiveXObject&&(t.requestFullScreen=function(){var e=new ActiveXObject("WScript.Shell");return null!==e&&e.SendKeys("{F11}"),!1},t.cancelFullScreen=t.requestFullScreen),e.extend(e,t)}(OpenSeadragon),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addHandler:function(t,i,n){var o=this.events[t];o||(this.events[t]=o=[]),i&&e.isFunction(i)&&(o[o.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n,o=this.events[t],r=[];if(o&&e.isArray(o)){for(n=0;n<o.length;n++)o[n].handler!==i&&r.push(o[n]);this.events[t]=r}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var n,o=t.length;for(n=0;o>n;n++)t[n]&&(i.eventSource=e,i.userData=t[n].userData,t[n].handler(i))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(e){function t(t){var i,n,o=["mouseover","mouseout","mousedown","mouseup","mousemove","click",e.MouseTracker.wheelEventName,"touchstart","touchmove","touchend","keypress","focus","blur"],r=D[t.hash];if("DOMMouseScroll"==e.MouseTracker.wheelEventName&&o.push("MozMousePixelScroll"),!r.tracking){for(n=0;n<o.length;n++)i=o[n],e.addEvent(t.element,i,r[i],!1);r.tracking=!0,I[t.hash]=t}}function i(t){var i,n,o=["mouseover","mouseout","mousedown","mouseup","mousemove","click",e.MouseTracker.wheelEventName,"touchstart","touchmove","touchend","keypress","focus","blur"],s=D[t.hash];if("DOMMouseScroll"==e.MouseTracker.wheelEventName&&o.push("MozMousePixelScroll"),s.tracking){for(n=0;n<o.length;n++)i=o[n],e.removeEvent(t.element,i,s[i],!1);r(t),s.tracking=!1,delete I[t.hash]}}function n(e){return D[e.hash].insideElement}function o(t){var i=D[t.hash];i.capturing||(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9?(e.removeEvent(t.element,"mouseup",i.mouseup,!1),e.addEvent(t.element,"mouseup",i.mouseupie,!0),e.addEvent(t.element,"mousemove",i.mousemovecapturedie,!0)):(e.addEvent(window,"mouseup",i.mouseupcaptured,!0),e.addEvent(window,"mousemove",i.mousemovecaptured,!0)),i.capturing=!0)}function r(t){var i=D[t.hash];i.capturing&&(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9?(e.removeEvent(t.element,"mousemove",i.mousemovecapturedie,!0),e.removeEvent(t.element,"mouseup",i.mouseupie,!0),e.addEvent(t.element,"mouseup",i.mouseup,!1)):(e.removeEvent(window,"mousemove",i.mousemovecaptured,!0),e.removeEvent(window,"mouseup",i.mouseupcaptured,!0)),i.capturing=!1)}function s(e,t,i,n){var o;for(o in I)I.hasOwnProperty(o)&&e.hash!=o&&t(I[o],i,n)}function a(t,i){var n;t.focusHandler&&(n=t.focusHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n===!1&&e.cancelEvent(i))}function l(t,i){var n;t.blurHandler&&(n=t.blurHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n===!1&&e.cancelEvent(i))}function h(t,i){var n;t.keyHandler&&(n=t.keyHandler({eventSource:t,position:R(i,t.element),keyCode:i.keyCode?i.keyCode:i.charCode,shift:i.shiftKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n||e.cancelEvent(i))}function c(t,i,n){var o,r=D[t.hash];if(n=n||!1,i=e.getEvent(i),!n){e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&r.capturing&&!H(i.srcElement,t.element)&&s(t,c,i,n);var a=i.target?i.target:i.srcElement,l=i.relatedTarget?i.relatedTarget:i.fromElement;if(!H(t.element,a)||H(t.element,l))return}r.insideElement=!0,t.enterHandler&&(o=t.enterHandler({eventSource:t,position:R(n?i.changedTouches[0]:i,t.element),insideElementPressed:r.insideElementPressed,buttonDownAny:_,isTouchEvent:n,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),o===!1&&e.cancelEvent(i))}function u(t,i,n){var o,r=D[t.hash];if(n=n||!1,i=e.getEvent(i),!n){e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&r.capturing&&!H(i.srcElement,t.element)&&s(t,u,i,n);var a=i.target?i.target:i.srcElement,l=i.relatedTarget?i.relatedTarget:i.toElement;if(!H(t.element,a)||H(t.element,l))return}r.insideElement=!1,t.exitHandler&&(o=t.exitHandler({eventSource:t,position:R(n?i.changedTouches[0]:i,t.element),insideElementPressed:r.insideElementPressed,buttonDownAny:_,isTouchEvent:n,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),o===!1&&e.cancelEvent(i))}function d(t,i,n,r){var s,a=D[t.hash];r=r||!1,i=e.getEvent(i);var l=r?i.touches[0]:i;2!=i.button&&(a.insideElementPressed=!0,a.lastPoint=O(l),a.lastMouseDownPoint=a.lastPoint,a.lastMouseDownTime=e.now(),t.pressHandler&&(s=t.pressHandler({eventSource:t,position:R(l,t.element),isTouchEvent:r,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),s===!1&&e.cancelEvent(i)),(t.pressHandler||t.dragHandler)&&e.cancelEvent(i),n||(!r&&e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&N?e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9&&A.push(t):(o(t),N=!0,A=[t])))}function p(t,i){var n,o;1==i.touches.length&&1==i.targetTouches.length&&1==i.changedTouches.length&&(D[t.hash].lastTouch=i.touches[0],c(t,i,!0),d(t,i,!0,!0)),2==i.touches.length&&(n=O(i.touches[0]),o=O(i.touches[1]),D[t.hash].lastPinchDelta=Math.abs(n.x-o.x)+Math.abs(n.y-o.y),D[t.hash].pinchMidpoint=new e.Point((n.x+o.x)/2,(n.y+o.y)/2)),i.preventDefault()}function m(t,i,n){var o,r=D[t.hash],s=r.insideElementPressed,a=r.insideElement;n=n||!1,i=e.getEvent(i),2!=i.button&&(r.insideElementPressed=!1,t.releaseHandler&&(o=t.releaseHandler({eventSource:t,position:R(n?i.changedTouches[0]:i,t.element),insideElementPressed:s,insideElementReleased:a,isTouchEvent:n,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),o===!1&&e.cancelEvent(i)),s&&a&&E(t,i,n))}function g(e,t){0===t.touches.length&&0===t.targetTouches.length&&1==t.changedTouches.length&&(D[e.hash].lastTouch=null,v(e,t,!0,!0),u(e,t,!0)),t.touches.length+t.changedTouches.length==2&&(D[e.hash].lastPinchDelta=null,D[e.hash].pinchMidpoint=null),t.preventDefault()}function f(t,i){var o,s;if(i=e.getEvent(i),2!=i.button){for(s=0;s<A.length;s++)o=A[s],n(o)||m(o,i,!1);r(t),N=!1,i.srcElement.fireEvent("on"+i.type,document.createEventObject(i)),e.stopEvent(i)}}function v(e,t,i,n){n=n||!1,(!D[e.hash].insideElement||n)&&m(e,t,n),i||r(e)}function w(t,i){if(t.moveHandler){i=e.getEvent(i);var n=t.moveHandler({eventSource:t,position:R(i,t.element),isTouchEvent:!1,originalEvent:i,preventDefaultAction:!1,userData:t.userData});n===!1&&e.cancelEvent(i)}t.stopHandler&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout(function(){y(t,i)},t.stopDelay))}function y(e,t){e.stopHandler&&e.stopHandler({eventSource:e,position:R(t,e.element),isTouchEvent:!1,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}function S(t,i){t.clickHandler&&e.cancelEvent(i)}function b(e,t){x(e,t,t,!1)}function T(t,i){i=i||window.event;var n={target:i.target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};n.deltaY="mousewheel"==e.MouseTracker.wheelEventName?-1/e.DEFAULT_SETTINGS.pixelsPerWheelLine*i.wheelDelta:i.detail,x(t,n,i,!1)}function x(t,i,n,o){var r,s=0;o=o||!1,s=i.deltaY<0?1:-1,t.scrollHandler&&(r=t.scrollHandler({eventSource:t,position:R(i,t.element),scroll:s,shift:i.shiftKey,isTouchEvent:o,originalEvent:n,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(n))}function E(t,i,n){var o,r=D[t.hash];n=n||!1,i=e.getEvent(i);var s=n?i.changedTouches[0]:i;if(2!=i.button){var a=e.now()-r.lastMouseDownTime,l=O(s),h=r.lastMouseDownPoint.distanceTo(l),c=a<=t.clickTimeThreshold&&h<=t.clickDistThreshold;t.clickHandler&&(o=t.clickHandler({eventSource:t,position:R(s,t.element),quick:c,shift:i.shiftKey,isTouchEvent:n,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),o===!1&&e.cancelEvent(i))}}function P(t,i,n){var o,r,s,a=D[t.hash];n=n||!1,i=e.getEvent(i);var l=n?i.touches[0]:i;s=O(l),o=s.minus(a.lastPoint),a.lastPoint=s,t.dragHandler&&(r=t.dragHandler({eventSource:t,position:R(l,t.element),delta:o,shift:i.shiftKey,isTouchEvent:n,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i))}function C(e,t){var i,n,o;if(D[e.hash].lastTouch){if(1===t.touches.length&&1===t.targetTouches.length&&1===t.changedTouches.length&&D[e.hash].lastTouch.identifier===t.touches[0].identifier)P(e,t,!0);else if(2===t.touches.length&&(i=O(t.touches[0]),n=O(t.touches[1]),o=Math.abs(i.x-n.x)+Math.abs(i.y-n.y),Math.abs(D[e.hash].lastPinchDelta-o)>75)){var r={target:t.target||t.srcElement,type:"wheel",shiftKey:t.shiftKey||!1,clientX:D[e.hash].pinchMidpoint.x,clientY:D[e.hash].pinchMidpoint.y,pageX:D[e.hash].pinchMidpoint.x,pageY:D[e.hash].pinchMidpoint.y,deltaMode:1,deltaX:0,deltaY:D[e.hash].lastPinchDelta>o?1:-1,deltaZ:0};x(e,r,t,!0),D[e.hash].lastPinchDelta=o}t.preventDefault()}}function $(t,i){var n;for(n=0;n<A.length;n++)P(A[n],i,!1);e.stopEvent(i)}function O(t){return e.getMousePosition(t)}function R(t,i){var n=e.getMousePosition(t),o=e.getElementOffset(i);return n.minus(o)}function H(e,t){for(var i=document.body;t&&e!=t&&i!=t;)try{t=t.parentNode}catch(n){return!1}return e==t}function k(){_=!0}function z(){_=!1}var _=!1,N=!1,I={},A=[],D={};e.MouseTracker=function(t){var i=arguments;e.isPlainObject(t)||(t={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.releaseHandler=t.releaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dragHandler=t.dragHandler||null,this.stopHandler=t.stopHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var n=this;D[this.hash]={mouseover:function(e){c(n,e,!1)},mouseout:function(e){u(n,e,!1)},mousedown:function(e){d(n,e)},mouseup:function(e){m(n,e,!1)},mousemove:function(e){w(n,e)},click:function(e){S(n,e)},wheel:function(e){b(n,e)},mousewheel:function(e){T(n,e)},DOMMouseScroll:function(e){T(n,e)},MozMousePixelScroll:function(e){T(n,e)},mouseupie:function(e){f(n,e)},mousemovecapturedie:function(e){$(n,e)},mouseupcaptured:function(e){v(n,e)},mousemovecaptured:function(e){P(n,e,!1)},touchstart:function(e){p(n,e)},touchmove:function(e){C(n,e)},touchend:function(e){g(n,e)},keypress:function(e){h(n,e)},focus:function(e){a(n,e)},blur:function(e){l(n,e)},tracking:!1,capturing:!1,insideElementPressed:!1,insideElement:!1,lastPoint:null,lastMouseDownTime:null,lastMouseDownPoint:null,lastPinchDelta:0}},e.MouseTracker.prototype={destroy:function(){i(this),this.element=null},isTracking:function(){return D[this.hash].tracking},setTracking:function(e){return e?t(this):i(this),this},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},releaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dragHandler:function(){},stopHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",function(){e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9?(e.addEvent(document,"mousedown",k,!1),e.addEvent(document,"mouseup",z,!1)):(e.addEvent(window,"mousedown",k,!0),e.addEvent(window,"mouseup",z,!0))}()}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4},e.Control=function(t,i,n){var o=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer="undefined"==typeof i.attachToViewer?!0:i.attachToViewer,this.autoFade="undefined"==typeof i.autoFade?!0:i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.wrapper=e.makeNeutralElement("span"),this.wrapper.style.display="inline-block",this.wrapper.appendChild(this.element),this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%"),i.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var i,n=e.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==t)return i;return-1}e.ControlDock=function(t){var i,n,o=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("form"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<o.length;n++)i=o[n],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){i=e.getElement(i);var o=null;if(!(t(this,i)>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:o=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:o=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;default:case e.ControlAnchor.NONE:o=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,o)),i.style.display="inline-block"}},removeControl:function(i){i=e.getElement(i);var n=t(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function($){function _getSafeElemSize(e){return e=$.getElement(e),new $.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function openTileSource(e,t){var i,n,o=e;for(o.source&&o.close(),o.canvas.innerHTML="",THIS[o.hash].prevContainerSize=_getSafeElemSize(o.container),o.collectionMode?(o.source=new $.TileSourceCollection({rows:o.collectionRows,layout:o.collectionLayout,tileSize:o.collectionTileSize,tileSources:o.tileSources,tileMargin:o.collectionTileMargin}),o.viewport=o.viewport?o.viewport:new $.Viewport({collectionMode:!0,collectionTileSource:o.source,containerSize:THIS[o.hash].prevContainerSize,contentSize:o.source.dimensions,springStiffness:o.springStiffness,animationTime:o.animationTime,showNavigator:!1,minZoomImageRatio:1,maxZoomPixelRatio:1,viewer:o})):(t&&(o.source=t),o.viewport=o.viewport?o.viewport:new $.Viewport({containerSize:THIS[o.hash].prevContainerSize,contentSize:o.source.dimensions,springStiffness:o.springStiffness,animationTime:o.animationTime,minZoomImageRatio:o.minZoomImageRatio,maxZoomPixelRatio:o.maxZoomPixelRatio,visibilityRatio:o.visibilityRatio,wrapHorizontal:o.wrapHorizontal,wrapVertical:o.wrapVertical,defaultZoomLevel:o.defaultZoomLevel,minZoomLevel:o.minZoomLevel,maxZoomLevel:o.maxZoomLevel,viewer:o})),o.preserveViewport&&o.viewport.resetContentSize(o.source.dimensions),o.source.overlays=o.source.overlays||[],o.drawer=new $.Drawer({viewer:o,source:o.source,viewport:o.viewport,element:o.canvas,overlays:[].concat(o.overlays).concat(o.source.overlays),maxImageCacheCount:o.maxImageCacheCount,imageLoaderLimit:o.imageLoaderLimit,minZoomImageRatio:o.minZoomImageRatio,wrapHorizontal:o.wrapHorizontal,wrapVertical:o.wrapVertical,immediateRender:o.immediateRender,blendTime:o.blendTime,alwaysBlend:o.alwaysBlend,minPixelRatio:o.collectionMode?0:o.minPixelRatio,timeout:o.timeout,debugMode:o.debugMode,debugGridColor:o.debugGridColor}),o.showNavigator&&!o.collectionMode&&(o.navigator?o.navigator.open(t):o.navigator=new $.Navigator({id:o.navigatorId,position:o.navigatorPosition,sizeRatio:o.navigatorSizeRatio,height:o.navigatorHeight,width:o.navigatorWidth,tileSources:t,tileHost:o.tileHost,prefixUrl:o.prefixUrl,overlays:o.overlays,viewer:o})),o.showReferenceStrip&&!o.referenceStrip&&(o.referenceStrip=new $.ReferenceStrip({id:o.referenceStripElement,position:o.referenceStripPosition,sizeRatio:o.referenceStripSizeRatio,scroll:o.referenceStripScroll,height:o.referenceStripHeight,width:o.referenceStripWidth,tileSources:o.tileSources,tileHost:o.tileHost,prefixUrl:o.prefixUrl,overlays:o.overlays,viewer:o})),THIS[o.hash].animating=!1,THIS[o.hash].forceRedraw=!0,o._updateRequestId=scheduleUpdate(o,updateMulti),n=0;n<o.overlayControls.length;n++)i=o.overlayControls[n],i.point?o.drawer.addOverlay(i.id,new $.Point(i.point.X,i.point.Y),$.OverlayPlacement.TOP_LEFT):o.drawer.addOverlay(i.id,new $.Rect(i.rect.Point.X,i.rect.Point.Y,i.rect.Width,i.rect.Height),i.placement);return VIEWERS[o.hash]=o,o.raiseEvent("open",{source:t}),o}function scheduleUpdate(e,t){return $.requestAnimationFrame(function(){t(e)})}function scheduleControlsFade(e){$.requestAnimationFrame(function(){updateControlsFade(e)})}function beginControlsAutoHide(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=$.now()+e.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(e)},e.controlsFadeDelay))}function updateControlsFade(e){var t,i,n,o;if(e.controlsShouldFade){for(t=$.now(),i=t-e.controlsFadeBeginTime,n=1-i/e.controlsFadeLength,n=Math.min(1,n),n=Math.max(0,n),o=e.controls.length-1;o>=0;o--)e.controls[o].autoFade&&e.controls[o].setOpacity(n);n>0&&scheduleControlsFade(e)}}function abortControlsAutoHide(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasClick(e){var t,i;!e.preventDefaultAction&&this.viewport&&e.quick&&(t=this.zoomPerClick,i=e.shift?1/t:t,this.viewport.zoomBy(i,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-click",{tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent})}function onCanvasDrag(e){!e.preventDefaultAction&&this.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate())),this.constrainDuringPan&&this.viewport.applyConstraints()),this.raiseEvent("canvas-drag",{tracker:e.eventSource,position:e.position,delta:e.delta,shift:e.shift,originalEvent:e.originalEvent})}function onCanvasRelease(e){e.insideElementPressed&&this.viewport&&this.viewport.applyConstraints(),this.raiseEvent("canvas-release",{tracker:e.eventSource,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function onCanvasScroll(e){var t;return!e.preventDefaultAction&&this.viewport&&(t=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(t,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function onContainerExit(e){e.insideElementPressed||(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function onContainerRelease(e){e.insideElementReleased||(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-release",{tracker:e.eventSource,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function onContainerEnter(e){THIS[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function updateMulti(e){return e.source?(updateOnce(e),void(e.source&&(e._updateRequestId=scheduleUpdate(e,updateMulti)))):void(e._updateRequestId=null)}function updateOnce(e){var t,i;if(e.source){if(e.autoResize&&(t=_getSafeElemSize(e.container),!t.equals(THIS[e.hash].prevContainerSize))){var n=e.viewport.getBounds(),o=e.viewport.getCenter();resizeViewportAndRecenter(e,t,n,o),THIS[e.hash].prevContainerSize=t,THIS[e.hash].forceRedraw=!0}i=e.viewport.update(),e.referenceStrip&&(i=e.referenceStrip.update(e.viewport)||i),!THIS[e.hash].animating&&i&&(e.raiseEvent("animation-start"),abortControlsAutoHide(e)),i?(e.drawer.update(),e.navigator&&e.navigator.update(e.viewport),e.raiseEvent("animation")):(THIS[e.hash].forceRedraw||e.drawer.needsUpdate())&&(e.drawer.update(),e.navigator&&e.navigator.update(e.viewport),THIS[e.hash].forceRedraw=!1),THIS[e.hash].animating&&!i&&(e.raiseEvent("animation-finish"),THIS[e.hash].mouseInside||beginControlsAutoHide(e)),THIS[e.hash].animating=i}}function resizeViewportAndRecenter(e,t,i,n){var o=e.viewport;
o.resize(t,!0);var r=1/e.source.aspectRatio,s=i.width<=1?i.width:1,a=i.height<=r?i.height:r,l=new $.Rect(n.x-s/2,n.y-a/2,s,a);o.fitBounds(l,!0)}function resolveUrl(e,t){return e?e+t:t}function beginZoomingIn(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=1/this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){THIS[this.hash].zooming=!1}function scheduleZoom(e){$.requestAnimationFrame($.delegate(e,doZoom))}function doZoom(){var e,t,i;THIS[this.hash].zooming&&this.viewport&&(e=$.now(),t=e-THIS[this.hash].lastZoomTime,i=Math.pow(THIS[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(i),this.viewport.applyConstraints(),THIS[this.hash].lastZoomTime=e,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullScreen(){this.isFullPage()&&!$.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onPrevious(){var e=THIS[this.hash].sequence-1;this.navPrevNextWrap&&0>e&&(e+=this.tileSources.length),this.goToPage(e)}function onNext(){var e=THIS[this.hash].sequence+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}var THIS={},VIEWERS={};$.Viewer=function(e){var t,i=arguments,n=this;if($.isPlainObject(e)||(e={id:i[0],xmlPath:i.length>1?i[1]:void 0,prefixUrl:i.length>2?i[2]:void 0,controls:i.length>3?i[3]:void 0,overlays:i.length>4?i[4]:void 0,overlayControls:i.length>5?i[5]:void 0}),e.config&&($.extend(!0,e,e.config),delete e.config),$.extend(!0,this,{id:e.id,hash:e.hash||e.id,element:null,container:null,keyboardCommandArea:null,canvas:null,overlays:[],overlayControls:[],previousBody:[],customControls:[],source:null,drawer:null,drawers:[],viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},$.DEFAULT_SETTINGS,e),"undefined"==typeof this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");"undefined"!=typeof THIS[this.hash]&&$.console.warn("Hash "+this.hash+" has already been used."),THIS[this.hash]={fsBoundsDelta:new $.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,sequenced:!1,sequence:0,fullPage:!1,onfullscreenchange:null},this._updateRequestId=null,$.EventSource.call(this),this.addHandler("open-failed",function(e){var t=$.getString("Errors.OpenFailed",e.eventSource,e.message);n._showMessage(t)}),$.ControlDock.call(this,e);var o;for(this.xmlPath&&(this.tileSources=[this.xmlPath]),this.tileSources&&($.isArray(this.tileSources)?(this.tileSources.length>1&&(THIS[this.hash].sequenced=!0),this.initialPage>this.tileSources.length-1&&(this.initialPage=this.tileSources.length-1),o=this.tileSources[this.initialPage],THIS[this.hash].sequence=this.initialPage):o=this.tileSources),this.element=this.element||document.getElementById(this.id),this.canvas=$.makeNeutralElement("div"),this.keyboardCommandArea=$.makeNeutralElement("textarea"),this.canvas.className="openseadragon-canvas",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.keyboardCommandArea.className="keyboard-command-area",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px",e.resize="none"}(this.keyboardCommandArea.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.container.insertBefore(this.keyboardCommandArea,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.keyboardCommandArea.innerTracker=new $.MouseTracker({_this:this,element:this.keyboardCommandArea,focusHandler:function(e){if(!e.preventDefaultAction){var t=$.getElementPosition(this.element);window.scrollTo(0,t.y)}},keyHandler:function(e){if(!e.preventDefaultAction)switch(e.keyCode){case 61:return n.viewport.zoomBy(1.1),n.viewport.applyConstraints(),!1;case 45:return n.viewport.zoomBy(.9),n.viewport.applyConstraints(),!1;case 48:return n.viewport.goHome(),n.viewport.applyConstraints(),!1;case 119:case 87:case 38:return e.shift?n.viewport.zoomBy(1.1):n.viewport.panBy(new $.Point(0,-.05)),n.viewport.applyConstraints(),!1;case 115:case 83:case 40:return e.shift?n.viewport.zoomBy(.9):n.viewport.panBy(new $.Point(0,.05)),n.viewport.applyConstraints(),!1;case 97:case 37:return n.viewport.panBy(new $.Point(-.05,0)),n.viewport.applyConstraints(),!1;case 100:case 39:return n.viewport.panBy(new $.Point(.05,0)),n.viewport.applyConstraints(),!1;default:return!0}}}).setTracking(!0),this.innerTracker=new $.MouseTracker({element:this.canvas,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,clickHandler:$.delegate(this,onCanvasClick),dragHandler:$.delegate(this,onCanvasDrag),releaseHandler:$.delegate(this,onCanvasRelease),scrollHandler:$.delegate(this,onCanvasScroll)}).setTracking(this.mouseNavEnabled?!0:!1),this.outerTracker=new $.MouseTracker({element:this.container,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:$.delegate(this,onContainerEnter),exitHandler:$.delegate(this,onContainerExit),releaseHandler:$.delegate(this,onContainerRelease)}).setTracking(this.mouseNavEnabled?!0:!1),this.toolbar&&(this.toolbar=new $.ControlDock({element:this.toolbar})),this.bindStandardControls(),this.bindSequenceControls(),o&&(this.open(o),this.tileSources.length>1&&this._updateSequenceButtons(this.initialPage)),t=0;t<this.customControls.length;t++)this.addControl(this.customControls[t].id,{anchor:this.customControls[t].anchor});$.requestAnimationFrame(function(){beginControlsAutoHide(n)})},$.extend($.Viewer.prototype,$.EventSource.prototype,$.ControlDock.prototype,{isOpen:function(){return!!this.source},openDzi:function(e){return this.open(e)},openTileSource:function(e){return this.open(e)},open:function(tileSource){var _this=this,customTileSource,readySource,$TileSource,options;return _this._hideMessage(),"string"==$.type(tileSource)&&(tileSource.match(/\s*<.*/)?tileSource=$.parseXml(tileSource):tileSource.match(/\s*[\{\[].*/)&&(tileSource=eval("("+tileSource+")"))),setTimeout(function(){if("string"==$.type(tileSource))tileSource=new $.TileSource(tileSource,function(e){openTileSource(_this,e.tileSource)}),tileSource.addHandler("open-failed",function(e){_this.raiseEvent("open-failed",e)});else if($.isPlainObject(tileSource)||tileSource.nodeType)if($.isFunction(tileSource.getTileUrl))customTileSource=new $.TileSource(tileSource),customTileSource.getTileUrl=tileSource.getTileUrl,openTileSource(_this,customTileSource);else{if($TileSource=$.TileSource.determineType(_this,tileSource),!$TileSource)return void _this.raiseEvent("open-failed",{message:"Unable to load TileSource",source:tileSource});options=$TileSource.prototype.configure.apply(_this,[tileSource]),readySource=new $TileSource(options),openTileSource(_this,readySource)}else openTileSource(_this,tileSource)},1),this},close:function(){return null!==this._updateRequestId&&($.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.navigator&&this.navigator.close(),this.drawer&&this.drawer.clearOverlays(),this.source=null,this.drawer=null,this.viewport=this.preserveViewport?this.viewport:null,this.canvas&&(this.canvas.innerHTML=""),VIEWERS[this.hash]=null,delete VIEWERS[this.hash],this.raiseEvent("close"),this},destroy:function(){if(this.close(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.keyboardCommandArea&&this.keyboardCommandArea.innerTracker.destroy(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),this.canvas=null,this.keyboardCommandArea=null,this.container=null,this.element=null},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisibile();return t},setControlsEnabled:function(e){return e?abortControlsAutoHide(this):beginControlsAutoHide(this),this.raiseEvent("controls-enabled",{enabled:e}),this},isFullPage:function(){return THIS[this.hash].fullPage},setFullPage:function(e){var t,i,n=document.body,o=n.style,r=document.documentElement.style,s=this;if(e==this.isFullPage())return this;var a={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",a),a.preventDefaultAction)return this;if(e){for(this.elementSize=$.getElementSize(this.element),this.pageScroll=$.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=r.margin,o.margin="0",r.margin="0",this.bodyPadding=o.padding,this.docPadding=r.padding,o.padding="0",r.padding="0",this.bodyWidth=o.width,this.bodyHeight=o.height,o.width="100%",o.height="100%",this.previousBody=[],THIS[this.hash].prevElementParent=this.element.parentNode,THIS[this.hash].prevNextSibling=this.element.nextSibling,THIS[this.hash].prevElementWidth=this.element.style.width,THIS[this.hash].prevElementHeight=this.element.style.height,t=n.childNodes.length,i=0;t>i;i++)this.previousBody.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,n.appendChild(this.toolbar.element),$.addClass(this.toolbar.element,"fullpage")),$.addClass(this.element,"fullpage"),n.appendChild(this.element),this.element.style.height=$.getWindowSize().y+"px",this.element.style.width=$.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=$.getElementSize(this.element).y-$.getElementSize(this.toolbar.element).y+"px"),THIS[this.hash].fullPage=!0,$.delegate(this,onContainerEnter)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,r.margin=this.docMargin,o.padding=this.bodyPadding,r.padding=this.docPadding,o.width=this.bodyWidth,o.height=this.bodyHeight,n.removeChild(this.element),t=this.previousBody.length,i=0;t>i;i++)n.appendChild(this.previousBody.shift());$.removeClass(this.element,"fullpage"),THIS[this.hash].prevElementParent.insertBefore(this.element,THIS[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(n.removeChild(this.toolbar.element),$.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=THIS[this.hash].prevElementWidth,this.element.style.height=THIS[this.hash].prevElementHeight;var l=0,h=function(){$.setPageScroll(s.pageScroll);var e=$.getPageScroll();l++,(10>l&&e.x!==s.pageScroll.x||e.y!==s.pageScroll.y)&&$.requestAnimationFrame(h)};$.requestAnimationFrame(h),THIS[this.hash].fullPage=!1,$.delegate(this,onContainerExit)({})}return this.raiseEvent("full-page",{fullPage:e}),this},setFullScreen:function(e){var t=this;if(!$.supportsFullScreen)return this.setFullPage(e);if($.isFullScreen()===e)return this;var i={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",i),i.preventDefaultAction)return this;if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var e=$.isFullScreen();e||($.removeEvent(document,$.fullScreenEventName,n),$.removeEvent(document,$.fullScreenErrorEventName,n),t.setFullPage(!1),t.isFullPage()&&(t.element.style.width=t.fullPageStyleWidth,t.element.style.height=t.fullPageStyleHeight)),t.raiseEvent("full-screen",{fullScreen:e})};$.addEvent(document,$.fullScreenEventName,n),$.addEvent(document,$.fullScreenErrorEventName,n),$.requestFullScreen(document.body)}else $.cancelFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},bindSequenceControls:function(){var e=$.delegate(this,onFocus),t=$.delegate(this,onBlur),i=$.delegate(this,onNext),n=$.delegate(this,onPrevious),o=this.navImages,r=!0;return this.showSequenceControl&&THIS[this.hash].sequenced&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new $.Button({element:this.previousButton?$.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,o.previous.REST),srcGroup:resolveUrl(this.prefixUrl,o.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,o.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,o.previous.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.nextButton=new $.Button({element:this.nextButton?$.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,o.next.REST),srcGroup:resolveUrl(this.prefixUrl,o.next.GROUP),srcHover:resolveUrl(this.prefixUrl,o.next.HOVER),srcDown:resolveUrl(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.navPrevNextWrap||this.previousButton.disable(),r&&(this.paging=new $.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:$.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:$.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=$.delegate(this,beginZoomingIn),t=$.delegate(this,endZooming),i=$.delegate(this,doSingleZoomIn),n=$.delegate(this,beginZoomingOut),o=$.delegate(this,doSingleZoomOut),r=$.delegate(this,onHome),s=$.delegate(this,onFullScreen),a=$.delegate(this,onFocus),l=$.delegate(this,onBlur),h=this.navImages,c=[],u=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton)&&(u=!1),c.push(this.zoomInButton=new $.Button({element:this.zoomInButton?$.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,h.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,h.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,h.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,h.zoomIn.DOWN),onPress:e,onRelease:t,onClick:i,onEnter:e,onExit:t,onFocus:a,onBlur:l})),c.push(this.zoomOutButton=new $.Button({element:this.zoomOutButton?$.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,h.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,h.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,h.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,h.zoomOut.DOWN),onPress:n,onRelease:t,onClick:o,onEnter:n,onExit:t,onFocus:a,onBlur:l})),c.push(this.homeButton=new $.Button({element:this.homeButton?$.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,h.home.REST),srcGroup:resolveUrl(this.prefixUrl,h.home.GROUP),srcHover:resolveUrl(this.prefixUrl,h.home.HOVER),srcDown:resolveUrl(this.prefixUrl,h.home.DOWN),onRelease:r,onFocus:a,onBlur:l})),c.push(this.fullPageButton=new $.Button({element:this.fullPageButton?$.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,h.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,h.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,h.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,h.fullpage.DOWN),onRelease:s,onFocus:a,onBlur:l})),u&&(this.buttons=new $.ButtonGroup({buttons:c,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",$.delegate(this,lightUp)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:$.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:$.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return THIS[this.hash].sequence},goToPage:function(e){return e>=0&&e<this.tileSources.length&&(this.raiseEvent("page",{page:e}),THIS[this.hash].sequence=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e)),this},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources.length-1===e?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var t=$.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=$.makeCenteredNode(t),$.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)}})}(OpenSeadragon),function(e){function t(t){var i,n,o;this.drag?this.drag=!1:this.viewer.viewport&&(n=this.viewport.deltaPointsFromPixels(t.position),o=this.viewer.viewport.getBounds().getSize(),i=new e.Rect(n.x-o.x/2,n.y-o.y/2,o.x,o.y),this.viewer.source.aspectRatio>this.viewer.viewport.getAspectRatio()?i.y=i.y-(this.viewerSizeInPoints.y-1/this.viewer.source.aspectRatio)/2:i.x=i.x-(this.viewerSizeInPoints.x-1)/2,this.viewer.viewport.fitBounds(i),this.viewer.viewport.applyConstraints())}function i(e){this.viewer.viewport&&(this.drag=!0,this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)))}function n(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}e.Navigator=function(o){var r,s=o.viewer,a=e.getElementSize(s.element);o.id?(this.element=document.getElementById(o.id),o.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(o.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),o.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:!0},o.position&&("BOTTOM_RIGHT"==o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==o.position?o.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==o.position&&(o.controlOptions.anchor=e.ControlAnchor.TOP_LEFT))),this.element.id=o.id,this.element.className+=" navigator",o=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},o,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),o.minPixelRatio=this.minPixelRatio=s.minPixelRatio,this.viewerSizeInPoints=s.viewport.deltaPointsFromPixels(a),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),function(e,t){e.margin="0px",e.border=t+"px solid #555",e.padding="0px",e.background="#000",e.opacity=.8,e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid #900",e.margin="0px",e.padding="0px",e.background="transparent",e["float"]="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.element.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:function(){return!1}}).setTracking(!0),s.addControl(this.element,o.controlOptions),o.width&&o.height?(this.element.style.width=o.width+"px",this.element.style.height=o.height+"px"):(this.element.style.width=a.x*o.sizeRatio+"px",this.element.style.height=a.y*o.sizeRatio+"px"),e.Viewer.apply(this,[o]),this.element.getElementsByTagName("form")[0].appendChild(this.displayRegion),r=this.element.getElementsByTagName("textarea")[0],r&&r.parentNode.removeChild(r)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{update:function(e){var t,i,n;e&&this.viewport&&(t=e.getBounds(!0),i=this.viewport.pixelFromPoint(t.getTopLeft()),n=this.viewport.pixelFromPoint(t.getBottomRight()).minus(this.totalBorderWidths),function(e){e.top=i.y+"px",e.left=i.x+"px";var t=Math.abs(i.x-n.x),o=Math.abs(i.y-n.y);e.width=Math.max(t,0)+"px",e.height=Math.max(o,0)+"px"}(this.displayRegion.style))},open:function(t){var i=this.viewer.viewport.containerSize.times(this.sizeRatio);return this.minPixelRatio=t.tileSize>i.x||t.tileSize>i.y?Math.min(i.x,i.y)/t.tileSize:this.viewer.minPixelRatio,e.Viewer.prototype.open.apply(this,[t])}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page"}};e.extend(e,{getString:function(i){var n,o=i.split("."),r=null,s=arguments,a=t;for(n=0;n<o.length-1;n++)a=a[o[n]]||{};return r=a[o[n]],"string"!=typeof r&&(e.console.debug("Untranslated source string:",i),r=""),r.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<s.length?s[t]:""})},setString:function(e,i){var n,o=e.split("."),r=t;for(n=0;n<o.length-1;n++)r[o[n]]||(r[o[n]]={}),r=r[o[n]];r[o[n]]=i}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var n=t*Math.PI/180,o=Math.cos(n)*(this.x-i.x)-Math.sin(n)*(this.y-i.y)+i.x,r=Math.sin(n)*(this.x-i.x)+Math.cos(n)*(this.y-i.y)+i.y;return new e.Point(o,r)},toString:function(){return"("+Math.round(this.x)+","+Math.round(this.y)+")"}}}(OpenSeadragon),function($){function processResponse(xhr){var responseText=xhr.responseText,status=xhr.status,statusText,data;if(!xhr)throw new Error($.getString("Errors.Security"));if(200!==xhr.status&&0!==xhr.status)throw status=xhr.status,statusText=404==status?"Not Found":xhr.statusText,new Error($.getString("Errors.Status",status,statusText));if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else data=responseText.match(/\s*[\{\[].*/)?eval("("+responseText+")"):responseText;return data}$.TileSource=function(e){var t,i,n=null,o=arguments;for(t=$.isPlainObject(e)?e:{width:o[0],height:o[1],tileSize:o[2],tileOverlap:o[3],minLevel:o[4],maxLevel:o[5]},$.EventSource.call(this),$.extend(!0,this,t),i=0;i<arguments.length;i++)if($.isFunction(arguments[i])){n=arguments[i],this.addHandler("ready",function(e){n(e)});break}"string"==$.type(arguments[0])?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this.tileSize=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(arguments[0])):(this.ready=!0,this.aspectRatio=t.width&&t.height?t.width/t.height:1,this.dimensions=new $.Point(t.width,t.height),this.tileSize=t.tileSize?t.tileSize:0,this.tileOverlap=t.tileOverlap?t.tileOverlap:0,this.minLevel=t.minLevel?t.minLevel:0,this.maxLevel=void 0!==t.maxLevel&&null!==t.maxLevel?t.maxLevel:t.width&&t.height?Math.ceil(Math.log(Math.max(t.width,t.height))/Math.log(2)):0,n&&$.isFunction(n)&&n(this))},$.TileSource.prototype={getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(e){var t=this.getLevelScale(e),i=Math.ceil(t*this.dimensions.x/this.tileSize),n=Math.ceil(t*this.dimensions.y/this.tileSize);return new $.Point(i,n)},getPixelRatio:function(e){var t=this.dimensions.times(this.getLevelScale(e)),i=1/t.x,n=1/t.y;return new $.Point(i,n)},getClosestLevel:function(e){var t,i,n=Math.floor(Math.max(e.x,e.y)/this.tileSize);for(t=this.minLevel;t<this.maxLevel&&(i=this.getNumTiles(t),!(Math.max(i.x,i.y)+1>=n));t++);return Math.max(0,t-1)},getTileAtPoint:function(e,t){var i=t.times(this.dimensions.x).times(this.getLevelScale(e)),n=Math.floor(i.x/this.tileSize),o=Math.floor(i.y/this.tileSize);return new $.Point(n,o)},getTileBounds:function(e,t,i){var n=this.dimensions.times(this.getLevelScale(e)),o=0===t?0:this.tileSize*t-this.tileOverlap,r=0===i?0:this.tileSize*i-this.tileOverlap,s=this.tileSize+(0===t?1:2)*this.tileOverlap,a=this.tileSize+(0===i?1:2)*this.tileOverlap,l=1/n.x;return s=Math.min(s,n.x-o),a=Math.min(a,n.y-r),new $.Rect(o*l,r*l,s*l,a*l)},getImageInfo:function(e){var t,i,n,o,r,s,a,l=this;e&&(r=e.split("/"),s=r[r.length-1],a=s.lastIndexOf("."),a>-1&&(r[r.length-1]=s.slice(0,a))),i=function(t){"string"==typeof t&&(t=$.parseXml(t));var i=$.TileSource.determineType(l,t,e);return i?(o=i.prototype.configure.apply(l,[t,e]),n=new i(o),l.ready=!0,void l.raiseEvent("ready",{tileSource:n})):void l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:e})},e.match(/\.js$/)?(t=e.split("/").pop().replace(".js",""),$.jsonp({url:e,async:!1,callbackName:t,callback:i})):$.makeAjaxRequest(e,function(e){var t=processResponse(e);i(t)},function(t,i){var n;try{n="HTTP "+t.status+" attempting to load TileSource"}catch(o){var r;r="undefined"!=typeof i&&i.toString?i.toString():"Unknown error",n=r+" attempting to load TileSource"}l.raiseEvent("open-failed",{message:n,source:e})})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y}},$.extend(!0,$.TileSource.prototype,$.EventSource.prototype),$.TileSource.determineType=function(e,t,i){var n;for(n in OpenSeadragon)if(n.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[n])&&$.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(e,t,i))return OpenSeadragon[n];$.console.error("No TileSource was able to open %s %s",i,t)}}(OpenSeadragon),function(e){function t(t,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var o,r,s,a,l,h=n.documentElement,c=h.tagName,u=null,d=[];if("Image"==c)try{if(a=h.getElementsByTagName("Size")[0],u={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(u.Image.Format))throw new Error(e.getString("Errors.ImageFormat",u.Image.Format.toUpperCase()));for(o=h.getElementsByTagName("DisplayRect"),l=0;l<o.length;l++)r=o[l],s=r.getElementsByTagName("Rect")[0],d.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}});return d.length&&(u.Image.DisplayRect=d),i(t,u)}catch(p){throw p instanceof Error?p:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==c)throw new Error(e.getString("Errors.Dzc"));if("Error"==c)return e._processDZIError(h)}throw new Error(e.getString("Errors.Dzi"))}function i(t,i){var n,o,r=i.Image,s=r.Url,a=r.Format,l=r.Size,h=r.DisplayRect||[],c=parseInt(l.Width,10),u=parseInt(l.Height,10),d=parseInt(r.TileSize,10),p=parseInt(r.Overlap,10),m=[];for(o=0;o<h.length;o++)n=h[o].Rect,m.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:c,height:u,tileSize:d,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:a,displayRects:m},i)}e.DziTileSource=function(t){var i,n,o,r;if(r=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=r.tilesUrl,this.fileFormat=r.fileFormat,this.displayRects=r.displayRects,this.displayRects)for(i=this.displayRects.length-1;i>=0;i--)for(n=this.displayRects[i],o=n.minLevel;o<=n.maxLevel;o++)this._levelRects[o]||(this._levelRects[o]=[]),this._levelRects[o].push(n);e.TileSource.apply(this,[r])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e){var t;return e.Image?t=e.Image.xmlns:e.documentElement&&"Image"==e.documentElement.tagName&&(t=e.documentElement.namespaceURI),"http://schemas.microsoft.com/deepzoom/2008"==t||"http://schemas.microsoft.com/deepzoom/2009"==t},configure:function(n,o){var r;return r=e.isPlainObject(n)?i(this,n):t(this,n),o&&!r.tilesUrl&&(r.tilesUrl=o.replace(/([^\/]+)\.(dzi|xml|js)$/,"$1_files/")),r},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat].join("")},tileExists:function(e,t,i){var n,o,r,s,a,l,h,c=this._levelRects[e];if(!c||!c.length)return!0;for(h=c.length-1;h>=0;h--)if(n=c[h],!(e<n.minLevel||e>n.maxLevel)&&(o=this.getLevelScale(e),r=n.x*o,s=n.y*o,a=r+n.width*o,l=s+n.height*o,r=Math.floor(r/this.tileSize),s=Math.floor(s/this.tileSize),a=Math.ceil(a/this.tileSize),l=Math.ceil(l/this.tileSize),t>=r&&a>t&&i>=s&&l>i))return!0;return!1}})}(OpenSeadragon),function(e){function t(t,o){if(!o||!o.documentElement)throw new Error(e.getString("Errors.Xml"));var r=o.documentElement,s=r.tagName,a=null;if("info"==s)try{return a={ns:r.namespaceURI},i(r,a),n(t,a)}catch(l){throw l instanceof Error?l:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function i(t,n,o){var r,s;if(3==t.nodeType&&o)s=t.nodeValue.trim(),s.match(/^\d*$/)&&(s=Number(s)),n[o]?(e.isArray(n[o])||(n[o]=[n[o]]),n[o].push(s)):n[o]=s;else if(1==t.nodeType)for(r=0;r<t.childNodes.length;r++)i(t.childNodes[r],n,t.nodeName)
}function n(e,t){return t.image_host&&(t.tilesUrl=t.image_host),t}e.IIIFTileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this.identifier&&this.tilesUrl))throw new Error("IIIF required parameters not provided.");if(t.tileSize=this.tile_width,!t.maxLevel){var i=-1,n=this.scale_factors||this.scale_factor;if(n instanceof Array)for(var o=0;o<n.length;o++){var r=Number(n[o]);!isNaN(r)&&r>i&&(i=r)}t.maxLevel=0>i?Number(Math.ceil(Math.log(Math.max(this.width,this.height),2))):i}e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.ns&&"http://library.stanford.edu/iiif/image-api/ns/"==e.ns||e.profile&&("http://library.stanford.edu/iiif/image-api/compliance.html#level1"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html#level2"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html#level3"==e.profile||"http://library.stanford.edu/iiif/image-api/compliance.html"==e.profile)||e.documentElement&&"info"==e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==e.documentElement.namespaceURI},configure:function(i,o){var r,s,a;return s=e.isPlainObject(i)?n(this,i):t(this,i),o&&!s.tilesUrl&&(r=o.split("/"),r.pop(),r=r.join("/"),"http"!==o.substring(0,4)&&(a=location.protocol+"//"+location.host,r=a+r),s.tilesUrl=r.replace(i.identifier,"")),s},getTileUrl:function(e,t,i){var n,o,r,s,a,l,h="0",c="native.jpg",u=Math.pow(.5,this.maxLevel-e),d=Math.ceil(this.width*u),p=Math.ceil(this.height*u),m=Math.ceil(this.tileSize/u),g=Math.ceil(this.tileSize/u);return d<this.tile_width&&p<this.tile_height?(l=d+",",n="full"):(o=t*m,r=i*g,s=Math.min(m,this.width-o),a=Math.min(g,this.height-r),l=Math.ceil(s*u)+",",n=[o,r,s,a].join(",")),[this.tilesUrl,this.identifier,n,l,h,c].join("/")}})}(OpenSeadragon),function(e){e.IIIF1_1TileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(t.tileSize=this.tile_width&&this.tile_height?this.tile_width:Math.min(this.height,this.width),!t.maxLevel){var i=-1,n=this.scale_factors||this.scale_factor;if(n instanceof Array)for(var o=0;o<n.length;o++){var r=Number(n[o]);!isNaN(r)&&r>i&&(i=r)}t.maxLevel=0>i?Number(Math.ceil(Math.log(Math.max(this.width,this.height),2))):i}e.TileSource.apply(this,[t])},e.extend(e.IIIF1_1TileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.profile&&("http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0"==e.profile||"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1"==e.profile||"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2"==e.profile||"http://library.stanford.edu/iiif/image-api/1.1/compliance.html"==e.profile)},configure:function(e){return e},getTileUrl:function(e,t,i){var n,o,r,s,a,l,h,c="0",u="native.jpg",d=Math.pow(.5,this.maxLevel-e),p=Math.ceil(this.width*d),m=Math.ceil(this.height*d),g=Math.ceil(this.tileSize/d),f=Math.ceil(this.tileSize/d);return p<this.tile_width&&m<this.tile_height?(l=p+","+m,n="full"):(o=t*g,r=i*f,s=Math.min(g,this.width-o),a=Math.min(f,this.height-r),l=Math.ceil(s*d)+","+Math.ceil(a*d),n=[o,r,s,a].join(",")),h=[this["@id"],n,l,c,u].join("/")}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t){var i;i=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},i.width&&i.height||(i.width=65572864,i.height=65572864),i.tileSize||(i.tileSize=256,i.tileOverlap=0),i.tilesUrl||(i.tilesUrl="http://tile.openstreetmap.org/"),i.minLevel=8,e.TileSource.apply(this,[i])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"openstreetmaps"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t){var i;i=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var n,o=256*Math.ceil(i.width/256),r=256*Math.ceil(i.height/256);n=o>r?o/256:r/256,i.maxLevel=Math.ceil(Math.log(n)/Math.log(2))-1,i.tileSize=256,i.width=o,i.height=r,e.TileSource.apply(this,[i])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"tiledmapservice"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){function t(t){var i,n,o=[];for(n=0;n<t.length;n++)i=t[n],i.height&&i.width&&i.url&&(i.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)||i.mimetype&&i.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/))?o.push({url:i.url,width:Number(i.width),height:Number(i.height)}):e.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return o.sort(function(e,t){return e.height-t.height})}function i(t,i){if(!i||!i.documentElement)throw new Error(e.getString("Errors.Xml"));var o,r,s=i.documentElement,a=s.tagName,l=null,h=[];if("image"==a)try{for(l={type:s.getAttribute("type"),levels:[]},h=s.getElementsByTagName("level"),r=0;r<h.length;r++)o=h[r],l.levels.push({url:o.getAttribute("url"),width:parseInt(o.getAttribute("width"),10),height:parseInt(o.getAttribute("height"),10)});return n(t,l)}catch(c){throw c instanceof Error?c:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+i)}throw new Error("Unknown element "+a)}function n(e,t){return t.levels}e.LegacyTileSource=function(i){var n,o,r;e.isArray(i)&&(n={type:"legacy-image-pyramid",levels:i}),n.levels=t(n.levels),n.levels.length>0?(o=n.levels[n.levels.length-1].width,r=n.levels[n.levels.length-1].height):(o=0,r=0,e.console.error("No supported image formats found")),e.extend(!0,n,{width:o,height:r,tileSize:Math.max(r,o),tileOverlap:0,minLevel:0,maxLevel:n.levels.length>0?n.levels.length-1:0}),e.TileSource.apply(this,[n]),this.levels=n.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(t){var o;return o=e.isPlainObject(t)?n(this,t):i(this,t)},getLevelScale:function(e){var t=0/0;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var i=this.getLevelScale(t);return i?new e.Point(1,1):new e.Point(0,0)},getTileAtPoint:function(){return new e.Point(0,0)},getTileUrl:function(e){var t=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].url),t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t){var i;i=e.isPlainObject(t)?t:{tileSize:arguments[0],tileSources:arguments[1],rows:arguments[2],layout:arguments[3]},i.layout||(i.layout="horizontal");var n=0,o=1,r=Math.ceil(i.tileSources.length/i.rows),s=r>=i.rows?r:i.rows;for("horizontal"==i.layout?(i.width=i.tileSize*r,i.height=i.tileSize*i.rows):(i.height=i.tileSize*r,i.width=i.tileSize*i.rows),i.tileOverlap=-i.tileMargin,i.tilesPerRow=r;o<i.tileSize*s;)o=2*o,n++;i.minLevel=n,e.TileSource.apply(this,[i])},e.extend(e.TileSourceCollection.prototype,e.TileSource.prototype,{getTileBounds:function(t,i,n){var o=this.dimensions.times(this.getLevelScale(t)),r=this.tileSize*i-this.tileOverlap,s=this.tileSize*n-this.tileOverlap,a=this.tileSize+1*this.tileOverlap,l=this.tileSize+1*this.tileOverlap,h=1/o.x;return a=Math.min(a,o.x-r),l=Math.min(l,o.y-s),new e.Rect(r*h,s*h,a*h,l*h)},configure:function(){},getTileUrl:function(){return null}})}(OpenSeadragon),function(e){function t(t){e.requestAnimationFrame(function(){i(t)})}function i(i){var n,o,r;i.shouldFade&&(n=e.now(),o=n-i.fadeBeginTime,r=1-o/i.fadeLength,r=Math.min(1,r),r=Math.max(0,r),i.imgGroup&&e.setElementOpacity(i.imgGroup,r,!0),r>0&&t(i))}function n(i){i.shouldFade=!0,i.fadeBeginTime=e.now()+i.fadeDelay,window.setTimeout(function(){t(i)},i.fadeDelay)}function o(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}function r(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(o(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function s(t,i){t.element.disabled||(i<=e.ButtonState.HOVER&&t.currentState==e.ButtonState.DOWN&&(t.imgDown&&(t.imgDown.style.visibility="hidden"),t.currentState=e.ButtonState.HOVER),i<=e.ButtonState.GROUP&&t.currentState==e.ButtonState.HOVER&&(t.imgHover&&(t.imgHover.style.visibility="hidden"),t.currentState=e.ButtonState.GROUP),i<=e.ButtonState.REST&&t.currentState==e.ButtonState.GROUP&&(n(t),t.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var i=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("button"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="")),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(r(i,e.ButtonState.DOWN),i.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||r(i,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),i.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){s(i,e.ButtonState.GROUP),t.insideElementPressed&&i.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),i.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){r(i,e.ButtonState.DOWN),i.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(s(i,e.ButtonState.HOVER),i.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?s(i,e.ButtonState.GROUP):r(i,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&i.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13===e.keyCode?(i.raiseEvent("click",{originalEvent:e.originalEvent}),i.raiseEvent("release",{originalEvent:e.originalEvent}),!1):!0}}).setTracking(!0),s(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){r(this,e.ButtonState.GROUP)},notifyGroupExit:function(){s(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),o=this;if(this.element=t.element||e.makeNeutralElement("fieldgroup"),!t.group)for(this.label=e.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),i=0;i<n.length;i++)this.element.appendChild(n[i].element);this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var e;for(e=0;e<o.buttons.length;e++)o.buttons[e].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<o.buttons.length;t++)o.buttons[t].notifyGroupExit()},releaseHandler:function(e){var t;if(!e.insideElementReleased)for(t=0;t<o.buttons.length;t++)o.buttons[t].notifyGroupExit()}}).setTracking(!0)},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(e,t,i,n){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0},e.Rect.prototype={getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height)},getTopRight:function(){return new e.Point(this.x+this.width,this.y)},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height)},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},rotate:function(t,i){var n,o=this.width,r=this.height;if(t=(t+360)%360,t%90!==0)throw new Error("Currently only 0, 90, 180, and 270 degrees are supported.");if(0===t)return new e.Rect(this.x,this.y,this.width,this.height);switch(i=i||this.getCenter(),t){case 90:n=this.getBottomLeft(),o=this.height,r=this.width;break;case 180:n=this.getBottomRight();break;case 270:n=this.getTopRight(),o=this.height,r=this.width;break;default:n=this.getTopLeft()}return n=n.rotate(t,i),new e.Rect(n.x,n.y,o,r)},toString:function(){return"["+Math.round(100*this.x)+","+Math.round(100*this.y)+","+Math.round(100*this.width)+"x"+Math.round(100*this.height)+"]"}}}(OpenSeadragon),function(e){function t(t){var i=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?i>-(r-a.x)&&(this.element.style.marginLeft=i+2*t.delta.x+"px",n(this,a.x,i+2*t.delta.x)):-t.delta.x<0&&0>i&&(this.element.style.marginLeft=i+2*t.delta.x+"px",n(this,a.x,i+2*t.delta.x)):-t.delta.y>0?o>-(s-a.y)&&(this.element.style.marginTop=o+2*t.delta.y+"px",n(this,a.y,o+2*t.delta.y)):-t.delta.y<0&&0>o&&(this.element.style.marginTop=o+2*t.delta.y+"px",n(this,a.y,o+2*t.delta.y))),!1}function i(t){var i=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?i>-(r-a.x)&&(this.element.style.marginLeft=i-60*t.scroll+"px",n(this,a.x,i-60*t.scroll)):t.scroll<0&&0>i&&(this.element.style.marginLeft=i-60*t.scroll+"px",n(this,a.x,i-60*t.scroll)):t.scroll<0?o>a.y-s&&(this.element.style.marginTop=o+60*t.scroll+"px",n(this,a.y,o+60*t.scroll)):t.scroll>0&&0>o&&(this.element.style.marginTop=o+60*t.scroll+"px",n(this,a.y,o+60*t.scroll))),!1}function n(t,i,n){var o,r,s,a,l,h,c;for(o="horizontal"==t.scroll?t.panelWidth:t.panelHeight,r=Math.ceil(i/o)+5,s=Math.ceil((Math.abs(n)+i)/o)+1,r=s-r,r=0>r?0:r,h=r;s>h&&h<t.panels.length;h++)c=t.panels[h],c.activePanel||(a=new e.Viewer({id:c.id,tileSources:[t.viewer.tileSources[h]],element:c,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),a.displayRegion=e.makeNeutralElement("textarea"),a.displayRegion.id=c.id+"-displayregion",a.displayRegion.className="displayregion",l=a.displayRegion.style,l.position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l.float="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",a.displayRegion.innerTracker=new e.MouseTracker({element:a.displayRegion}),c.getElementsByTagName("form")[0].appendChild(a.displayRegion),c.activePanel=!0)}function o(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function r(t){var i=t.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+e.getElementSize(i).y/2+"px":i.style.marginLeft="-"+e.getElementSize(i).x/2+"px",!1}function s(e){switch(e.keyCode){case 61:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:case 38:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 40:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:case 37:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:case 39:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}var a={};e.ReferenceStrip=function(l){var h,c,u,d=this,p=l.viewer,m=e.getElementSize(p.element);for(l.id||(l.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=l.id,this.element.className="referencestrip"),l=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},l,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,l),a[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,c=this.element.style,c.marginTop="0px",c.marginRight="0px",c.marginBottom="0px",c.marginLeft="0px",c.left="0px",c.bottom="0px",c.border="0px",c.background="#000",c.position="relative",e.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,t),scrollHandler:e.delegate(this,i),enterHandler:e.delegate(this,o),exitHandler:e.delegate(this,r),keyHandler:e.delegate(this,s)}).setTracking(!0),l.width&&l.height?(this.element.style.width=l.width+"px",this.element.style.height=l.height+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==l.scroll?(this.element.style.width=m.x*l.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=m.y*l.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*l.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=m.x*l.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],u=0;u<p.tileSources.length;u++)h=e.makeNeutralElement("div"),h.id=this.element.id+"-"+u,h.style.width=d.panelWidth+"px",h.style.height=d.panelHeight+"px",h.style.display="inline",h.style.float="left",h.style.cssFloat="left",h.style.styleFloat="left",h.style.padding="2px",h.innerTracker=new e.MouseTracker({element:h,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var i=t.eventSource,n=i.element.id,o=Number(n.split("-")[2]),r=e.now();t.insideElementPressed&&t.insideElementReleased&&i.dragging&&r-i.dragging<i.clickTimeThreshold&&(i.dragging=null,p.goToPage(o))}}).setTracking(!0),this.element.appendChild(h),h.activePanel=!1,this.panels.push(h);n(this,"vertical"==this.scroll?m.y:m.y,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var i,r=e.getElement(this.element.id+"-"+t),s=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==r&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=r,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(t)*(this.panelWidth+3),i>h+s.x-this.panelWidth?(i=Math.min(i,a-s.x),this.element.style.marginLeft=-i+"px",n(this,s.x,-i)):h>i&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",n(this,s.x,-i))):(i=Number(t)*(this.panelHeight+3),i>c+s.y-this.panelHeight?(i=Math.min(i,l-s.y),this.element.style.marginTop=-i+"px",n(this,s.y,-i)):c>i&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",n(this,s.y,-i))),this.currentPage=t,e.getElement(r.id+"-displayregion").focus(),o.call(this,{eventSource:this.innerTracker}))},update:function(){return a[this.id].animating?(e.console.log("image reference strip update"),!0):!1}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,n,o,r,s){e.Rect.apply(this,[t,i,n,o]),this.minLevel=r,this.maxLevel=s},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){function t(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:0,time:e.now()},this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time}},e.Spring.prototype={resetTo:function(e){this.target.value=e,this.target.time=this.current.time,this.start.value=this.target.value,this.start.time=this.target.time},springTo:function(e){this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime},shiftBy:function(e){this.start.value+=e,this.target.value+=e},update:function(){this.current.time=e.now(),this.current.value=this.current.time>=this.target.time?this.target.value:this.start.value+(this.target.value-this.start.value)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time))}}}(OpenSeadragon),function(e){var t={};e.Tile=function(e,t,i,n,o,r){this.level=e,this.x=t,this.y=i,this.bounds=n,this.exists=o,this.url=r,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},drawHTML:function(t){return this.loaded&&this.image?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=e.makeNeutralElement("img"),this.imgElement.src=this.url,this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",void e.setElementOpacity(this.element,this.opacity)):void e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())},drawCanvas:function(i){var n,o,r=this.position,s=this.size;return this.loaded&&(this.image||t[this.url])?(i.globalAlpha=this.opacity,1==i.globalAlpha&&this.url.match(".png")&&i.clearRect(r.x+1,r.y+1,s.x-2,s.y-2),t[this.url]||(o=document.createElement("canvas"),o.width=this.image.width,o.height=this.image.height,n=o.getContext("2d"),n.drawImage(this.image,0,0),t[this.url]=n,this.image=null),n=t[this.url],void i.drawImage(n.canvas,0,0,n.canvas.width,n.canvas.height,r.x,r.y,s.x,s.y)):void e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),t[this.url]&&delete t[this.url],this.element=null,this.imgElement=null,this.image=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8},e.Overlay=function(t,i,n){var o;o=e.isPlainObject(t)?t:{element:t,location:i,placement:n},this.element=o.element,this.scales=o.location instanceof e.Rect,this.bounds=new e.Rect(o.location.x,o.location.y,o.location.width,o.location.height),this.position=new e.Point(o.location.x,o.location.y),this.size=new e.Point(o.location.width,o.location.height),this.style=o.element.style,this.placement=o.location instanceof e.Point?o.placement:e.OverlayPlacement.TOP_LEFT,this.onDraw=o.onDraw},e.Overlay.prototype={adjust:function(t,i){switch(this.placement){case e.OverlayPlacement.TOP_LEFT:break;case e.OverlayPlacement.TOP:t.x-=i.x/2;break;case e.OverlayPlacement.TOP_RIGHT:t.x-=i.x;break;case e.OverlayPlacement.RIGHT:t.x-=i.x,t.y-=i.y/2;break;case e.OverlayPlacement.BOTTOM_RIGHT:t.x-=i.x,t.y-=i.y;break;case e.OverlayPlacement.BOTTOM:t.x-=i.x/2,t.y-=i.y;break;case e.OverlayPlacement.BOTTOM_LEFT:t.y-=i.y;break;case e.OverlayPlacement.LEFT:t.y-=i.y/2;break;default:case e.OverlayPlacement.CENTER:t.x-=i.x/2,t.y-=i.y/2}},destroy:function(){var e=this.element,t=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(t.display="none",document.body.appendChild(e))),this.onDraw=null,t.top="",t.left="",t.position="",this.scales&&(t.width="",t.height="")},drawHTML:function(t,i){var n,o,r,s=this.element,a=this.style,l=this.scales,h=new e.Point(i.viewer.drawer.canvas.width/2,i.viewer.drawer.canvas.height/2),c=i.degrees;s.parentNode!=t&&(s.prevElementParent=s.parentNode,s.prevNextSibling=s.nextSibling,t.appendChild(s)),l||(this.size=e.getElementSize(s)),n=this.position,o=this.size,this.adjust(n,o),n=n.apply(Math.floor),o=o.apply(Math.ceil),0!==c&&this.scales&&(r=new e.Point(o.x/2,o.y/2),n=n.plus(r).rotate(c,h).minus(r),o=o.rotate(c,new e.Point(0,0)),o=new e.Point(Math.abs(o.x),Math.abs(o.y))),this.onDraw?this.onDraw(n,o,s):(a.left=n.x+"px",a.top=n.y+"px",a.position="absolute",a.display="block",l&&(a.width=o.x+"px",a.height=o.y+"px"))},update:function(t,i){this.scales=t instanceof e.Rect,this.bounds=new e.Rect(t.x,t.y,t.width,t.height),this.placement=t instanceof e.Point?i:e.OverlayPlacement.TOP_LEFT}}}(OpenSeadragon),function(e){function t(t,i){var n=null,o=i.height&&i.width?new e.Rect(i.x||i.px,i.y||i.py,i.width,i.height):new e.Point(i.x||i.px,i.y||i.py),r=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());return n=e.getElement(i.id),n||(n=document.createElement("a"),n.href="#/overlay/"+r),n.id=r,e.addClass(n,i.className?i.className:"openseadragon-overlay"),void 0!==i.px&&(o=t.viewport.imageToViewportRectangle(o)),new e.Overlay(i.placement?{element:n,location:t.viewport.pointFromPixel(o),placement:e.OverlayPlacement[i.placement.toUpperCase()],onDraw:i.onDraw}:{element:n,location:o,onDraw:i.onDraw})}function i(t){t.updateAgain=!1,t.viewer&&t.viewer.raiseEvent("update-viewport",{});for(var i,o,r,a,l,h,c,d,p=null,m=!1,g=e.now(),f=t.viewport.getContainerSize(),v=t.viewport.getBounds(!0),y=v.getTopLeft(),b=v.getBottomRight(),T=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(0),!0).x,x=Math.max(t.source.minLevel,Math.floor(Math.log(t.minZoomImageRatio)/Math.log(2))),E=Math.min(Math.abs(t.source.maxLevel),Math.abs(Math.floor(Math.log(T/t.minPixelRatio)/Math.log(2)))),P=t.viewport.degrees;t.lastDrawn.length>0;)i=t.lastDrawn.pop(),i.beingDrawn=!1;if(t.canvas.innerHTML="",t.useCanvas&&((t.canvas.width!=f.x||t.canvas.height!=f.y)&&(t.canvas.width=f.x,t.canvas.height=f.y),t.context.clearRect(0,0,f.x,f.y)),90===P||270===P){var C=v.rotate(P);y=C.getTopLeft(),b=C.getBottomRight()}if(!(!t.wrapHorizontal&&(b.x<0||y.x>1)||!t.wrapVertical&&(b.y<0||y.y>t.normHeight))){t.wrapHorizontal||(y.x=Math.max(y.x,0),b.x=Math.min(b.x,1)),t.wrapVertical||(y.y=Math.max(y.y,0),b.y=Math.min(b.y,t.normHeight)),x=Math.min(x,E);var $;for(o=E;o>=x;o--){if($=!1,r=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(o),!0).x,!m&&r>=t.minPixelRatio||o==x)$=!0,m=!0;else if(!m)continue;if(a=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(o),!1).x,l=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(Math.max(t.source.getClosestLevel(t.viewport.containerSize)-1,0)),!1).x,h=t.immediateRender?1:l,c=Math.min(1,(r-.5)/.5),d=h/Math.abs(h-a),p=n(t,m,$,o,c,d,y,b,g,p),u(t.coverage,o))break}S(t,t.lastDrawn),w(t.viewport,t.overlays,t.container),p&&(s(t,p,g),t.updateAgain=!0)}}function n(e,t,i,n,r,s,a,l,h,c){var u,d,p,g,f,v=e.viewport.pixelFromPoint(e.viewport.getCenter());for(e.viewer&&e.viewer.raiseEvent("update-level",{havedrawn:t,level:n,opacity:r,visibility:s,topleft:a,bottomright:l,currenttime:h,best:c}),p=e.source.getTileAtPoint(n,a),g=e.source.getTileAtPoint(n,l),f=e.source.getNumTiles(n),m(e.coverage,n),e.wrapHorizontal||(g.x=Math.min(g.x,f.x-1)),e.wrapVertical||(g.y=Math.min(g.y,f.y-1)),u=p.x;u<=g.x;u++)for(d=p.y;d<=g.y;d++)c=o(e,i,t,u,d,n,r,s,v,f,h,c);return c}function o(e,t,i,n,o,s,a,c,u,m,g,v){var w=r(n,o,s,e.source,e.tilesMatrix,g,m,e.normHeight),y=t;if(e.viewer&&e.viewer.raiseEvent("update-tile",{tile:w}),p(e.coverage,s,n,o,!1),!w.exists)return v;if(i&&!y&&(d(e.coverage,s,n,o)?p(e.coverage,s,n,o,!0):y=!0),!y)return v;if(l(w,e.source.tileOverlap,e.viewport,u,c),w.loaded){var S=h(e,w,n,o,s,a,g);S&&(e.updateAgain=!0)}else w.loading||(v=f(v,w));return v}function r(t,i,n,o,r,s,a,l){var h,c,u,d,p,m;return r[n]||(r[n]={}),r[n][t]||(r[n][t]={}),r[n][t][i]||(h=(a.x+t%a.x)%a.x,c=(a.y+i%a.y)%a.y,u=o.getTileBounds(n,h,c),d=o.tileExists(n,h,c),p=o.getTileUrl(n,h,c),u.x+=1*(t-h)/a.x,u.y+=l*(i-c)/a.y,r[n][t][i]=new e.Tile(n,t,i,u,d,p)),m=r[n][t][i],m.lastTouchTime=s,m}function s(e,t,i){e.viewport.collectionMode?(e.midUpdate=!1,a(e,t,i)):t.loading=e.loadImage(t.url,function(n){a(e,t,i,n)})}function a(t,i,n,o){var r,s,a,l,h,c,u,d,p,m;if(i.loading=!1,t.midUpdate)return void e.console.warn("Tile load callback in middle of drawing routine.");if(o||t.viewport.collectionMode){if(n<t.lastResetTime)return void e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url)}else if(e.console.log("Tile %s failed to load: %s",i,i.url),!t.debugMode)return void(i.exists=!1);if(i.loaded=!0,i.image=o,r=t.tilesLoaded.length,t.tilesLoaded.length>=t.maxImageCacheCount){for(s=Math.ceil(Math.log(t.source.tileSize)/Math.log(2)),a=null,c=-1,m=t.tilesLoaded.length-1;m>=0;m--)u=t.tilesLoaded[m],u.level<=t.cutoff||u.beingDrawn||(a?(d=u.lastTouchTime,l=a.lastTouchTime,p=u.level,h=a.level,(l>d||d==l&&p>h)&&(a=u,c=m)):(a=u,c=m));a&&c>=0&&(a.unload(),r=c)}t.tilesLoaded[r]=i,t.updateAgain=!0}function l(t,i,n,o,r){var s=t.bounds.getTopLeft(),a=t.bounds.getSize(),l=n.pixelFromPoint(s,!0),h=n.pixelFromPoint(s,!1),c=n.deltaPixelsFromPoints(a,!0),u=n.deltaPixelsFromPoints(a,!1),d=h.plus(u.divide(2)),p=o.distanceTo(d);
i||(c=c.plus(new e.Point(1,1))),t.position=l,t.size=c,t.distance=p,t.visibility=r}function h(e,t,i,n,o,r,s){var a,l,h=1e3*e.blendTime;if(t.blendStart||(t.blendStart=s),a=s-t.blendStart,l=h?Math.min(1,a/h):1,e.alwaysBlend&&(l*=r),t.opacity=l,e.lastDrawn.push(t),1==l)p(e.coverage,o,i,n,!0);else if(h>a)return!0;return!1}function c(e){e.tilesMatrix={},e.tilesLoaded=[]}function u(e,t,i,n){var o,r,s,a;if(!e[t])return!1;if(void 0===i||void 0===n){o=e[t];for(s in o)if(o.hasOwnProperty(s)){r=o[s];for(a in r)if(r.hasOwnProperty(a)&&!r[a])return!1}return!0}return void 0===e[t][i]||void 0===e[t][i][n]||e[t][i][n]===!0}function d(e,t,i,n){return void 0===i||void 0===n?u(e,t+1):u(e,t+1,2*i,2*n)&&u(e,t+1,2*i,2*n+1)&&u(e,t+1,2*i+1,2*n)&&u(e,t+1,2*i+1,2*n+1)}function p(t,i,n,o,r){return t[i]?(t[i][n]||(t[i][n]={}),void(t[i][n][o]=r)):void e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)}function m(e,t){e[t]={}}function g(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element==t)return i;return-1}function f(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.distance<e.distance?t:e:t}function v(t,i,n,o){t.onload=null,t.onabort=null,t.onerror=null,o&&window.clearTimeout(o),e.requestAnimationFrame(function(){i(t.src,n?t:null)})}function w(e,t,i){var n,o=t.length;for(n=0;o>n;n++)y(e,t[n],i)}function y(e,t,i){t.position=e.pixelFromPoint(t.bounds.getTopLeft(),!0),t.size=e.deltaPixelsFromPoints(t.bounds.getSize(),!0),t.drawHTML(i,e)}function S(t,i){var n,o,r,s,a,l,h,c;for(n=i.length-1;n>=0;n--){if(o=i[n],t.viewport.collectionMode?(r=o.x+"/"+o.y,a=t.viewport,c=a.collectionTileSource,t.collectionOverlays[r]?(s=t.collectionOverlays[r],s.viewport&&(s.viewport.resize(o.size,!0),s.viewport.goHome(!0))):(l="horizontal"==c.layout?o.y+o.x*c.rows:o.x+o.y*c.rows,h=l<c.tileSources.length?c.tileSources[l]:null,h&&(t.collectionOverlays[r]=s=new e.Viewer({hash:a.viewer.hash+"-"+r,element:e.makeNeutralElement("div"),mouseNavEnabled:!1,showNavigator:!1,showSequenceControl:!1,showNavigationControl:!1,tileSources:[h]}),C&&(s.element.style.border="1px solid rgba(255,255,255,0.38)",s.element.style["-webkit-box-reflect"]="below 0px -webkit-gradient(linear,left top,left bottom,from(transparent),color-stop(62%,transparent),to(rgba(255,255,255,0.62)))"),t.addOverlay(s.element,o.bounds)))):(t.useCanvas?0!==t.viewport.degrees?(b(o,t.canvas,t.context,t.viewport.degrees),o.drawCanvas(t.context),T(o,t.canvas,t.context)):o.drawCanvas(t.context):o.drawHTML(t.canvas),o.beingDrawn=!0),t.debugMode)try{x(t,o,i.length,n)}catch(u){e.console.error(u)}t.viewer&&t.viewer.raiseEvent("tile-drawn",{tile:o})}}function b(e,t,i,n){var o=t.width/2,r=t.height/2,s=e.position.x-o,a=e.position.y-r;i.save(),i.translate(o,r),i.rotate(Math.PI/180*n),e.position.x=s,e.position.y=a}function T(e,t,i){var n=t.width/2,o=t.height/2,r=e.position.x+n,s=e.position.y+o;e.position.x=r,e.position.y=s,i.restore()}function x(e,t,i,n){e.useCanvas&&(e.context.save(),e.context.lineWidth=2,e.context.font="small-caps bold 13px ariel",e.context.strokeStyle=e.debugGridColor,e.context.fillStyle=e.debugGridColor,e.context.strokeRect(t.position.x,t.position.y,t.size.x,t.size.y),0===t.x&&0===t.y&&(e.context.fillText("Zoom: "+e.viewport.getZoom(),t.position.x,t.position.y-30),e.context.fillText("Pan: "+e.viewport.getBounds().toString(),t.position.x,t.position.y-20)),e.context.fillText("Level: "+t.level,t.position.x+10,t.position.y+20),e.context.fillText("Column: "+t.x,t.position.x+10,t.position.y+30),e.context.fillText("Row: "+t.y,t.position.x+10,t.position.y+40),e.context.fillText("Order: "+n+" of "+i,t.position.x+10,t.position.y+50),e.context.fillText("Size: "+t.size.toString(),t.position.x+10,t.position.y+60),e.context.fillText("Position: "+t.position.toString(),t.position.x+10,t.position.y+70),e.context.restore())}var E=(e.getWindowSize(),e.Browser.vendor),P=e.Browser.version,C=E==e.BROWSERS.FIREFOX||E==e.BROWSERS.OPERA||E==e.BROWSERS.SAFARI&&P>=4||E==e.BROWSERS.CHROME&&P>=2||E==e.BROWSERS.IE&&P>=9;e.Drawer=function(i){var n,o=arguments;for(e.isPlainObject(i)||(i={source:o[0],viewport:o[1],element:o[2]}),e.extend(!0,this,{viewer:null,downloading:0,tilesMatrix:{},tilesLoaded:[],coverage:{},lastDrawn:[],lastResetTime:0,midUpdate:!1,updateAgain:!0,overlays:[],collectionOverlays:{},maxImageCacheCount:e.DEFAULT_SETTINGS.maxImageCacheCount,imageLoaderLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,debugMode:e.DEFAULT_SETTINGS.debugMode,timeout:e.DEFAULT_SETTINGS.timeout},i),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(this.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.normHeight=this.source.dimensions.y/this.source.dimensions.x,this.element=this.container,this.container.dir="ltr",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.container.style.textAlign="left",this.container.appendChild(this.canvas),n=0;n<this.overlays.length;n++)e.isPlainObject(this.overlays[n])?this.overlays[n]=t(this,this.overlays[n]):e.isFunction(this.overlays[n])},e.Drawer.prototype={addOverlay:function(t,i,n,o){var r;return r=e.isPlainObject(t)?t:{element:t,location:i,placement:n,onDraw:o},t=e.getElement(r.element),g(this.overlays,t)>=0?void 0:(this.overlays.push(new e.Overlay({element:t,location:r.location,placement:r.placement,onDraw:r.onDraw})),this.updateAgain=!0,this.viewer&&this.viewer.raiseEvent("add-overlay",{element:t,location:r.location,placement:r.placement}),this)},updateOverlay:function(t,i,n){var o;return t=e.getElement(t),o=g(this.overlays,t),o>=0&&(this.overlays[o].update(i,n),this.updateAgain=!0),this.viewer&&this.viewer.raiseEvent("update-overlay",{element:t,location:i,placement:n}),this},removeOverlay:function(t){var i;return t=e.getElement(t),i=g(this.overlays,t),i>=0&&(this.overlays[i].destroy(),this.overlays.splice(i,1),this.updateAgain=!0),this.viewer&&this.viewer.raiseEvent("remove-overlay",{element:t}),this},clearOverlays:function(){for(;this.overlays.length>0;)this.overlays.pop().destroy(),this.updateAgain=!0;return this.viewer&&this.viewer.raiseEvent("clear-overlay",{}),this},needsUpdate:function(){return this.updateAgain},numTilesLoaded:function(){return this.tilesLoaded.length},reset:function(){return c(this),this.lastResetTime=e.now(),this.updateAgain=!0,this},update:function(){return this.midUpdate=!0,i(this),this.midUpdate=!1,this},loadImage:function(t,i){var n,o,r,s=this,a=!1;return(!this.imageLoaderLimit||this.downloading<this.imageLoaderLimit)&&(this.downloading++,n=new Image,r=function(n,o){if(s.downloading--,"function"==typeof i)try{i(o)}catch(r){e.console.error("%s while executing %s callback: %s",r.name,t,r.message,r)}},n.onload=function(){v(n,r,!0,o)},n.onabort=n.onerror=function(){v(n,r,!1,o)},o=window.setTimeout(function(){v(n,r,!1,o)},this.timeout),a=!0,n.src=t),a},canRotate:function(){return this.useCanvas}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees},t),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.resetContentSize(this.contentSize),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return this.contentSize=t,this.contentAspectX=this.contentSize.x/this.contentSize.y,this.contentAspectY=this.contentSize.y/this.contentSize.x,this.fitWidthBounds=new e.Rect(0,0,1,this.contentAspectY),this.fitHeightBounds=new e.Rect(0,0,this.contentAspectY,this.contentAspectY),this.homeBounds=new e.Rect(0,0,1,this.contentAspectY),this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:t}),this},getHomeZoom:function(){var e=this.contentAspectX/this.getAspectRatio();return this.defaultZoomLevel?this.defaultZoomLevel:e>=1?1:e},getHomeBounds:function(){var t=this.homeBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),t=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return Math.min(t,e)},getMaxZoom:function(){var e=this.maxZoomLevel?this.maxZoomLevel:this.contentSize.x*this.maxZoomPixelRatio/this.containerSize.x;return Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this.containerSize.x/this.containerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getBounds:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),o=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-o/2,n,o)},getCenter:function(t){var i,n,o,r,s,a,l,h,c=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),u=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?c:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),n=this.getZoom(),o=1/n,r=o/this.getAspectRatio(),s=new e.Rect(c.x-o/2,c.y-r/2,o,r),a=this.zoomPoint.minus(s.getTopLeft()).times(this.containerSize.x/s.width),l=a.minus(i),h=l.divide(this.containerSize.x*n),u.plus(h)):u},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},applyConstraints:function(e){var t,i,n,o,r,s,a,l=this.getZoom(),h=Math.max(Math.min(l,this.getMaxZoom()),this.getMinZoom()),c=0,u=0;return l!=h&&this.zoomTo(h,this.zoomPoint,e),t=this.getBounds(),i=this.visibilityRatio*t.width,n=this.visibilityRatio*t.height,o=t.x+t.width,r=1-t.x,s=t.y+t.height,a=this.contentAspectY-t.y,this.wrapHorizontal||(i>o&&(c=i-o),i>r&&(c=c?(c+r-i)/2:r-i)),this.wrapVertical||(n>s&&(u=n-s),n>a&&(u=u?(u+a-n)/2:a-n)),(c||u||e)&&(t.x+=c,t.y+=u,t.width>1&&(t.x=.5-t.width/2),t.height>this.contentAspectY&&(t.y=this.contentAspectY/2-t.height/2),this.fitBounds(t,e)),this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e}),this},ensureVisible:function(e){return this.applyConstraints(e)},fitBounds:function(t,i){var n,o,r,s,a=this.getAspectRatio(),l=t.getCenter(),h=new e.Rect(t.x,t.y,t.width,t.height);return h.getAspectRatio()>=a?(h.height=t.width/a,h.y=l.y-h.height/2):(h.width=t.height*a,h.x=l.x-h.width/2),this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),n=this.getBounds(),o=this.getZoom(),r=1/h.width,r==o||h.width==n.width?this.panTo(l,i):(s=n.getTopLeft().times(this.containerSize.x/n.width).minus(h.getTopLeft().times(this.containerSize.x/h.width)).divide(this.containerSize.x/n.width-this.containerSize.x/h.width),this.zoomTo(r,s,i))},fitVertically:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(1+t.x%1)%1,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(this.contentAspectY+t.y%this.contentAspectY)%this.contentAspectY,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitHeightBounds,e)},fitHorizontally:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(this.contentAspectX+t.x%this.contentAspectX)%this.contentAspectX,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(1+t.y%1)%1,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitWidthBounds,e)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t=t.rotate(-this.degrees,new e.Point(0,0)),this.panTo(n.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(t,i,n){return i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)&&(i=i.rotate(-this.degrees,new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value))),this.zoomTo(this.zoomSpring.target.value*t,i,n)},zoomTo:function(t,i,n){return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this.zoomSpring.resetTo(t):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(e){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(e=(e+360)%360,e%90!==0)throw new Error("Currently only 0, 90, 180, and 270 degrees are supported.");return this.degrees=e,this.viewer.drawer.update(),this},getRotation:function(){return this.degrees},resize:function(t,i){var n,o=this.getBounds(),r=o;return this.containerSize=new e.Point(t.x,t.y),i&&(n=t.x/this.containerSize.x,r.width=o.width*n,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(r,!0)},update:function(){var e,t,i,n,o=this.centerSpringX.current.value,r=this.centerSpringY.current.value,s=this.zoomSpring.current.value;return this.zoomPoint&&(e=this.pixelFromPoint(this.zoomPoint,!0)),this.zoomSpring.update(),this.zoomPoint&&this.zoomSpring.current.value!=s?(t=this.pixelFromPoint(this.zoomPoint,!0),i=t.minus(e),n=this.deltaPointsFromPixels(i,!0),this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y)):this.zoomPoint=null,this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!=o||this.centerSpringY.current.value!=r||this.zoomSpring.current.value!=s},deltaPixelsFromPoints:function(e,t){return e.times(this.containerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return e.divide(this.containerSize.x*this.getZoom(t))},pixelFromPoint:function(e,t){var i=this.getBounds(t);return e.minus(i.getTopLeft()).times(this.containerSize.x/i.width)},pointFromPixel:function(e,t){var i=this.getBounds(t);return e.divide(this.containerSize.x/i.width).plus(i.getTopLeft())},viewportToImageCoordinates:function(t,i){return 1==arguments.length?this.viewportToImageCoordinates(t.x,t.y):new e.Point(t*this.contentSize.x,i*this.contentSize.y*this.contentAspectX)},imageToViewportCoordinates:function(t,i){return 1==arguments.length?this.imageToViewportCoordinates(t.x,t.y):new e.Point(t/this.contentSize.x,i/this.contentSize.y/this.contentAspectX)},imageToViewportRectangle:function(t,i,n,o){var r,s,a;return 1==arguments.length?(a=t,this.imageToViewportRectangle(a.x,a.y,a.width,a.height)):(r=this.imageToViewportCoordinates(t,i),s=this.imageToViewportCoordinates(n,o),new e.Rect(r.x,r.y,s.x,s.y))},viewportToImageRectangle:function(t,i,n,o){var r,s,a;return 1==arguments.length?(a=t,this.viewportToImageRectangle(a.x,a.y,a.width,a.height)):(r=this.viewportToImageCoordinates(t,i),s=this.viewportToImageCoordinates(n,o),new e.Rect(r.x,r.y,s.x,s.y))},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.pixelFromPoint(e,!0);return this.imageToViewportCoordinates(t)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){var t=this.imageToViewerElementCoordinates(e);return t.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},windowToViewportCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(t)},viewportToWindowCoordinates:function(e){var t=this.viewportToViewerElementCoordinates(e);return t.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){var t=this.viewer.source.dimensions.x,i=this.getContainerSize().x,n=i/t;return e*n},imageToViewportZoom:function(e){var t=this.viewer.source.dimensions.x,i=this.getContainerSize().x,n=t/i;return e*n}}}(OpenSeadragon),$(function(){HumEditViewer.AnnotationViewerPopover=Backbone.View.extend({popOverTemplate:JST["hum_edit_viewer/templates/annotation_viewer_popover"],anchorPointHTML:"<div class='anchor-point'></div>",className:"annotation-popover",events:{"click .catalog-popup":"onCatalogPopup"},initialize:function(){this.annotatedSpan=this.options.span,this.annotation=this.options.annotation,this.parentEl=this.options.parentEl,this.externalContentPath=this.options.externalContentPath,this.documentViewport=$("#document-viewport"),this.placement="top",_.bindAll(this,"renderForm","close","updatePosition")},render:function(){this.anchorPoint=$(this.anchorPointHTML),this.$el.html(this.anchorPoint),this.anchorPoint.popover({animation:!0,html:!0,placement:this.placement,trigger:"manual",title:this.annotation.tagTemplate.display_name,content:this.renderForm}),$("body").append(this.el),this.anchorPoint.popover("show"),this.updatePosition(),this.startTrackingPosition(),this.$(".done-button").click(this.close)},startTrackingPosition:function(){$(window).resize(this.updatePosition),this.documentViewport.bind("scroll",this.updatePosition),this.parentEl.bind("scroll",this.updatePosition)},updatePosition:function(){var e=this.annotatedSpan.offset(),t=this.documentViewport.width(),i=e.left/t*200+5,n={left:e.left-i,top:e.top},o=this.parentEl,r=o.offset(),s=r.top+o.height();this.$el.offset(n),this.$(".arrow").offset({left:e.left}),(n.top<r.top||n.top>s)&&this.close()},close:function(){return $(window).unbind("resize",this.updatePosition),this.documentViewport.unbind("scroll",this.updatePosition),this.parentEl.unbind("scroll",this.updatePosition),this.$el.remove(),!1},renderForm:function(){return this.popOverTemplate({tagTemplate:this.annotation.tagTemplate,annoData:this.annotation.data})},onCatalogPopup:function(e){var t=$(e.currentTarget).attr("eid"),i=$(e.currentTarget).attr("type"),n=this.externalContentPath+i+"?eid="+t;return 0!=this.externalContentPath.indexOf("/catalog")&&(n=this.externalContentPath+i+"."+t+".json"),new HumEditViewer.CatalogViewerDialog({src:n,type:i}),!1}})}),$(function(){HumEditViewer.CatalogViewerDialog=Backbone.View.extend({catalogDialogTemplate:JST["hum_edit_viewer/templates/catalog_viewer_dialog"],events:{"click .close-button":"close","click .cancel-button":"close",keyup:"onKeypress"},initialize:function(){_.bindAll(this,"renderForm","close"),this.payload={},this.type=this.options.type,this.getContent(this.options.src)},render:function(){this.$el.html(this.renderForm()),$("body").prepend(this.$el),$("#catalog-display-dialog").modal({backdrop:!1})},close:function(){return this.$el.remove(),!1},renderForm:function(){return this.catalogDialogTemplate({type:this.type,payload:this.payload})},getContent:function(e){$.ajax({url:e,type:"GET",success:_.bind(function(e){this.onGetResponse(e)},this),error:_.bind(function(e,t,i){alert("get failed; status ["+t+"], error ["+i+"], response ["+e.responseText+"]")},this)})},onGetResponse:function(e){this.payload=e,this.render()}})});var HumEditViewer={};$(function(){HumEditViewer.PublishedView=Backbone.View.extend({initialize:function(){this.tagTemplates=$.parseJSON(this.$("#tag_templatesJSON").val())},render:function(){this.sbsViewer=new HumEditViewer.SBSViewer({el:this.$("#document-viewport"),tagTemplates:this.tagTemplates,externalContentPath:this.options.externalContentPath}),this.sbsViewer.render(),_.each(this.$(".dragon"),function(e){OpenSeadragon({id:e.id,prefixUrl:this.options.seaDragonAssetsPath,tileSources:$(e).attr("data-tile-source-url"),maxZoomPixelRatio:5})},this)}})}),$(function(){HumEditViewer.SBSPageViewer=Backbone.View.extend({initialize:function(){var e=this.options.tagTemplates;this.annotations=$.parseJSON(this.$("#annotationsJSON").val()),_.each(this.annotations,function(t){t.data=$.parseJSON(t.data),t.tagTemplate=e[t.name]})},render:function(){var e=this.$(".annotation");_.each(e,function(e){var t=$(e),i=t.attr("data-annotation-id"),n=null!=i?i.split(","):[],o=_.first(n),r=_.find(this.annotations,function(e){return o==e.id});t.click(_.bind(function(){this.annotationViewer&&this.annotationViewer.close(),this.annotationViewer=new HumEditViewer.AnnotationViewerPopover({span:t,parentEl:this.$(".page"),annotation:r,externalContentPath:this.options.externalContentPath}),this.annotationViewer.render()},this))},this);var t=this.$(".interline-annotation");_.each(t,function(t){var i=$(t),n=i.attr("data-interline-annotation"),o=_.find(e,function(e){var t=$(e).attr("data-annotation-id"),i=null!=t?t.split(","):[];return _.contains(i,n)}),r=parseInt(this.$(".page").css("padding-left")),s=$(o).prev(),a=s.length>0?s.position().left+s.width():0,l=i.position().left-a-r;$(o).css("margin-left",l+"px")},this)}})}),$(function(){HumEditViewer.SBSViewer=Backbone.View.extend({initialize:function(){this.tagTemplates=this.options.tagTemplates},render:function(){var e=this.$(".sbs-page");this.sbsPages=_.map(e,function(e){var t=new HumEditViewer.SBSPageViewer({el:$(e),tagTemplates:this.tagTemplates,externalContentPath:this.options.externalContentPath});return t.render(),t},this)}})}),function(){this.JST||(this.JST={}),this.JST["hum_edit_viewer/templates/annotation_viewer_popover"]=function(obj){var __p=[];with(obj||{})__p.push('<div class="annotation-data-form">\n	'),_.each(tagTemplate.fields,function(e){__p.push("\n		"),annoData[e.name]&&annoData[e.name].length>0&&__p.push("\n			<p>",e.display_name,": ",annoData[e.name],"</p>				\n		"),__p.push("\n	")}),__p.push('\n	<button type="button" class="btn btn-xs btn-primary done-button">Close</button>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["hum_edit_viewer/templates/catalog_viewer_dialog"]=function(obj){var __p=[];with(obj||{})__p.push('<div id="catalog-display-dialog" class="modal fade">\n    <div class="modal-dialog dialog">\n        <div class="modal-content">\n\n            <div class="modal-header thinner">\n                <button type="button" class="close cancel-button" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">Catalog Content</h4>\n            </div>\n\n            <div class="modal-body thinner scrollable">\n\n               <form class="form-horizontal">\n\n                '),"image"===type?(__p.push("\n\n                  "),has_images(payload)&&__p.push('\n                    <div class="form-group">\n                        ',make_image_tag(get_full_url(payload)),"\n                    </div>\n                  "),__p.push("\n\n                ")):(__p.push("\n\n                  "),has_images(payload.entry.images)&&__p.push('\n                    <div class="form-group">\n                      ',make_image_tag(get_medium_url(payload.entry.images)),"\n                    </div>\n                  "),__p.push("\n\n                  "),_.each(payload.fieldlist,function(e){__p.push('\n\n                    <div class="form-group">\n                      <label class="col-sm-2 control-label">',humanize(e),'</label>\n                          <div class="col-sm-10">\n                              ');var t="";__p.push("\n                              "),"affiliation"===e?(__p.push("\n                                 "),_.each(payload.entry[e],function(e){__p.push("\n                                    "),t+=e.affiliation+":"+e.type+":"+e.subtype+":"+e.role+":"+e.from+":"+e.to+" ",__p.push("\n                                 ")}),__p.push("\n                              ")):"nationality"===e?(__p.push("\n                                 "),_.each(payload.entry[e],function(e){__p.push("\n                                    "),t+=e.nationality+":"+e.from+":"+e.to+" ",__p.push("\n                                 ")}),__p.push("\n                              ")):"occupation"===e?(__p.push("\n                                 "),_.each(payload.entry[e],function(){__p.push("\n                                    "),t+=occupation.occupation+":"+occupation.from+":"+occupation.to+" ",__p.push("\n                                 ")}),__p.push("\n                              ")):"see_also"===e?(__p.push("\n                                 "),_.each(payload.entry[e],function(e){__p.push("\n                                    "),t+=e.description+":"+e.url+" ",__p.push("\n                                 ")}),__p.push("\n                              ")):(__p.push("\n                                 "),t=tags_display(payload.entry[e]),__p.push("\n                              ")),__p.push('\n                              <p class="form-control-static" id="',e,'">',t,"</p>\n                          </div>\n                    </div>\n\n                  ")}),__p.push("\n                ")),__p.push('\n\n               </form>\n            </div>\n\n            <div class="modal-footer thinner">\n                <button type="button" class="btn btn-primary close-button">Close</button>\n            </div>\n\n        </div>\n    </div>\n</div>\n');return __p.join("")}}.call(this);